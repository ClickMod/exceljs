{"version":3,"file":"worksheet-writer.js","names":["_","require","RelType","colCache","Encryptor","Dimensions","StringBuf","Row","Column","SheetRelsWriter","SheetCommentsWriter","DataValidations","xmlBuffer","ListXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","ColXform","RowXform","HyperlinkXform","SheetViewXform","SheetProtectionXform","PageMarginsXform","PageSetupXform","AutoFilterXform","PictureXform","ConditionalFormattingsXform","HeaderFooterXform","RowBreaksXform","xform","dataValidations","sheetProperties","sheetFormatProperties","columns","tag","length","childXform","row","hyperlinks","sheetViews","sheetProtection","pageMargins","pageSeteup","autoFilter","picture","conditionalFormattings","headerFooter","rowBreaks","WorksheetWriter","options","_classCallCheck","id","name","concat","state","_rows","_columns","_keys","_merges","add","_sheetRelsWriter","_sheetCommentsWriter","_dimensions","_rowZero","committed","_formulae","_siFormulae","conditionalFormatting","properties","Object","assign","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","differentFirst","differentOddEven","oddHeader","oddFooter","evenHeader","evenFooter","firstHeader","firstFooter","pageSetup","margins","left","right","top","bottom","header","footer","orientation","horizontalDpi","verticalDpi","fitToPage","fitToWidth","fitToHeight","scale","pageOrder","blackAndWhite","draft","cellComments","errors","paperSize","undefined","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","colBreaks","useSharedStrings","_workbook","workbook","hasComments","_views","views","_media","_writeOpenWorksheet","startedData","_createClass","key","get","_stream","_openStream","pause","value","destroy","Error","commit","_this","forEach","cRow","_writeRow","_writeOpenSheetData","_writeCloseSheetData","_writeAutoFilter","_writeMergeCells","_writeHyperlinks","_writeConditionalFormatting","_writeDataValidations","_writeSheetProtection","_writePageMargins","_writePageSetup","_writeBackground","_writeHeaderFooter","_writeRowBreaks","_writeLegacyData","_writeCloseWorksheet","stream","end","set","_this2","_headerRowCount","reduce","pv","cv","headerCount","headers","Math","max","count","defn","column","push","getColumnKey","setColumnKey","deleteColumnKey","eachColumnKey","f","each","getColumn","c","col","l2n","n","eachRow","iteratee","includeEmpty","_nextRow","i","getRow","hasValues","number","_commitRow","found","shift","findRow","rowNumber","index","addRow","values","findCell","r","address","getAddress","getCell","getCellEx","mergeCells","_len","arguments","cells","Array","_key","dimensions","merge","intersects","master","j","addConditionalFormatting","cf","removeConditionalFormatting","filter","splice","Function","addBackgroundImage","imageId","_background","getBackgroundImageId","protect","password","_this3","Promise","resolve","sheet","spinCount","Number","isFinite","round","algorithmName","saltValue","randomBytes","toString","hashValue","convertPasswordToHash","unprotect","_write","text","reset","addText","write","_writeSheetProperties","xmlBuf","sheetPropertiesModel","outlineProperties","tabColor","toXml","_writeSheetFormatProperties","sheetFormatPropertiesModel","defaultColWidth","_writeColumns","cols","toModel","prepare","styles","height","model","sharedStrings","hyperlinksProxy","merges","formulae","siFormulae","comments","addComments","_hyperlinks","image","getImage","pictureId","addMedia","Target","Type","Image","_objectSpread","rId","vmlRelId","_writeDimensions","module","exports"],"sources":["../../../../lib/stream/xlsx/worksheet-writer.js"],"sourcesContent":["const _ = require('../../utils/under-dash');\n\nconst RelType = require('../../xlsx/rel-type');\n\nconst colCache = require('../../utils/col-cache');\nconst Encryptor = require('../../utils/encryptor');\nconst Dimensions = require('../../doc/range');\nconst StringBuf = require('../../utils/string-buf');\n\nconst Row = require('../../doc/row');\nconst Column = require('../../doc/column');\n\nconst SheetRelsWriter = require('./sheet-rels-writer');\nconst SheetCommentsWriter = require('./sheet-comments-writer');\nconst DataValidations = require('../../doc/data-validations');\n\nconst xmlBuffer = new StringBuf();\n\n// ============================================================================================\n// Xforms\nconst ListXform = require('../../xlsx/xform/list-xform');\nconst DataValidationsXform = require('../../xlsx/xform/sheet/data-validations-xform');\nconst SheetPropertiesXform = require('../../xlsx/xform/sheet/sheet-properties-xform');\nconst SheetFormatPropertiesXform = require('../../xlsx/xform/sheet/sheet-format-properties-xform');\nconst ColXform = require('../../xlsx/xform/sheet/col-xform');\nconst RowXform = require('../../xlsx/xform/sheet/row-xform');\nconst HyperlinkXform = require('../../xlsx/xform/sheet/hyperlink-xform');\nconst SheetViewXform = require('../../xlsx/xform/sheet/sheet-view-xform');\nconst SheetProtectionXform = require('../../xlsx/xform/sheet/sheet-protection-xform');\nconst PageMarginsXform = require('../../xlsx/xform/sheet/page-margins-xform');\nconst PageSetupXform = require('../../xlsx/xform/sheet/page-setup-xform');\nconst AutoFilterXform = require('../../xlsx/xform/sheet/auto-filter-xform');\nconst PictureXform = require('../../xlsx/xform/sheet/picture-xform');\nconst ConditionalFormattingsXform = require('../../xlsx/xform/sheet/cf/conditional-formattings-xform');\nconst HeaderFooterXform = require('../../xlsx/xform/sheet/header-footer-xform');\nconst RowBreaksXform = require('../../xlsx/xform/sheet/row-breaks-xform');\n\n// since prepare and render are functional, we can use singletons\nconst xform = {\n  dataValidations: new DataValidationsXform(),\n  sheetProperties: new SheetPropertiesXform(),\n  sheetFormatProperties: new SheetFormatPropertiesXform(),\n  columns: new ListXform({tag: 'cols', length: false, childXform: new ColXform()}),\n  row: new RowXform(),\n  hyperlinks: new ListXform({tag: 'hyperlinks', length: false, childXform: new HyperlinkXform()}),\n  sheetViews: new ListXform({tag: 'sheetViews', length: false, childXform: new SheetViewXform()}),\n  sheetProtection: new SheetProtectionXform(),\n  pageMargins: new PageMarginsXform(),\n  pageSeteup: new PageSetupXform(),\n  autoFilter: new AutoFilterXform(),\n  picture: new PictureXform(),\n  conditionalFormattings: new ConditionalFormattingsXform(),\n  headerFooter: new HeaderFooterXform(),\n  rowBreaks: new RowBreaksXform(),\n};\n\n// ============================================================================================\n\nclass WorksheetWriter {\n  constructor(options) {\n    // in a workbook, each sheet will have a number\n    this.id = options.id;\n\n    // and a name\n    this.name = options.name || `Sheet${this.id}`;\n\n    // add a state\n    this.state = options.state || 'visible';\n\n    // rows are stored here while they need to be worked on.\n    // when they are committed, they will be deleted.\n    this._rows = [];\n\n    // column definitions\n    this._columns = null;\n\n    // column keys (addRow convenience): key ==> this._columns index\n    this._keys = {};\n\n    // keep a record of all row and column pageBreaks\n    this._merges = [];\n    this._merges.add = function() {}; // ignore cell instruction\n\n    // keep record of all hyperlinks\n    this._sheetRelsWriter = new SheetRelsWriter(options);\n\n    this._sheetCommentsWriter = new SheetCommentsWriter(this, this._sheetRelsWriter, options);\n\n    // keep a record of dimensions\n    this._dimensions = new Dimensions();\n\n    // first uncommitted row\n    this._rowZero = 1;\n\n    // committed flag\n    this.committed = false;\n\n    // for data validations\n    this.dataValidations = new DataValidations();\n\n    // for sharing formulae\n    this._formulae = {};\n    this._siFormulae = 0;\n\n    // keep a record of conditionalFormattings\n    this.conditionalFormatting = [];\n\n    // keep a record of all row and column pageBreaks\n    this.rowBreaks = [];\n\n    // for default row height, outline levels, etc\n    this.properties = Object.assign(\n      {},\n      {\n        defaultRowHeight: 15,\n        dyDescent: 55,\n        outlineLevelCol: 0,\n        outlineLevelRow: 0,\n      },\n      options.properties\n    );\n\n    this.headerFooter = Object.assign(\n      {},\n      {\n        differentFirst: false,\n        differentOddEven: false,\n        oddHeader: null,\n        oddFooter: null,\n        evenHeader: null,\n        evenFooter: null,\n        firstHeader: null,\n        firstFooter: null,\n      },\n      options.headerFooter\n    );\n\n    // for all things printing\n    this.pageSetup = Object.assign(\n      {},\n      {\n        margins: {left: 0.7, right: 0.7, top: 0.75, bottom: 0.75, header: 0.3, footer: 0.3},\n        orientation: 'portrait',\n        horizontalDpi: 4294967295,\n        verticalDpi: 4294967295,\n        fitToPage: !!(\n          options.pageSetup &&\n          (options.pageSetup.fitToWidth || options.pageSetup.fitToHeight) &&\n          !options.pageSetup.scale\n        ),\n        pageOrder: 'downThenOver',\n        blackAndWhite: false,\n        draft: false,\n        cellComments: 'None',\n        errors: 'displayed',\n        scale: 100,\n        fitToWidth: 1,\n        fitToHeight: 1,\n        paperSize: undefined,\n        showRowColHeaders: false,\n        showGridLines: false,\n        horizontalCentered: false,\n        verticalCentered: false,\n        rowBreaks: null,\n        colBreaks: null,\n      },\n      options.pageSetup\n    );\n\n    // using shared strings creates a smaller xlsx file but may use more memory\n    this.useSharedStrings = options.useSharedStrings || false;\n\n    this._workbook = options.workbook;\n\n    this.hasComments = false;\n\n    // views\n    this._views = options.views || [];\n\n    // auto filter\n    this.autoFilter = options.autoFilter || null;\n\n    this._media = [];\n\n    // worksheet protection\n    this.sheetProtection = null;\n\n    // start writing to stream now\n    this._writeOpenWorksheet();\n\n    this.startedData = false;\n  }\n\n  get workbook() {\n    return this._workbook;\n  }\n\n  get stream() {\n    if (!this._stream) {\n      // eslint-disable-next-line no-underscore-dangle\n      this._stream = this._workbook._openStream(`/xl/worksheets/sheet${this.id}.xml`);\n\n      // pause stream to prevent 'data' events\n      this._stream.pause();\n    }\n    return this._stream;\n  }\n\n  // destroy - not a valid operation for a streaming writer\n  // even though some streamers might be able to, it's a bad idea.\n  destroy() {\n    throw new Error('Invalid Operation: destroy');\n  }\n\n  commit() {\n    if (this.committed) {\n      return;\n    }\n    // commit all rows\n    this._rows.forEach(cRow => {\n      if (cRow) {\n        // write the row to the stream\n        this._writeRow(cRow);\n      }\n    });\n\n    // we _cannot_ accept new rows from now on\n    this._rows = null;\n\n    if (!this.startedData) {\n      this._writeOpenSheetData();\n    }\n    this._writeCloseSheetData();\n    this._writeAutoFilter();\n    this._writeMergeCells();\n\n    // for some reason, Excel can't handle dimensions at the bottom of the file\n    // this._writeDimensions();\n\n    this._writeHyperlinks();\n    this._writeConditionalFormatting();\n    this._writeDataValidations();\n    this._writeSheetProtection();\n    this._writePageMargins();\n    this._writePageSetup();\n    this._writeBackground();\n    this._writeHeaderFooter();\n    this._writeRowBreaks();\n\n    // Legacy Data tag for comments\n    this._writeLegacyData();\n\n    this._writeCloseWorksheet();\n    // signal end of stream to workbook\n    this.stream.end();\n\n    this._sheetCommentsWriter.commit();\n    // also commit the hyperlinks if any\n    this._sheetRelsWriter.commit();\n\n    this.committed = true;\n  }\n\n  // return the current dimensions of the writer\n  get dimensions() {\n    return this._dimensions;\n  }\n\n  get views() {\n    return this._views;\n  }\n\n  // =========================================================================\n  // Columns\n\n  // get the current columns array.\n  get columns() {\n    return this._columns;\n  }\n\n  // set the columns from an array of column definitions.\n  // Note: any headers defined will overwrite existing values.\n  set columns(value) {\n    // calculate max header row count\n    this._headerRowCount = value.reduce((pv, cv) => {\n      const headerCount = (cv.header && 1) || (cv.headers && cv.headers.length) || 0;\n      return Math.max(pv, headerCount);\n    }, 0);\n\n    // construct Column objects\n    let count = 1;\n    const columns = (this._columns = []);\n    value.forEach(defn => {\n      const column = new Column(this, count++, false);\n      columns.push(column);\n      column.defn = defn;\n    });\n  }\n\n  getColumnKey(key) {\n    return this._keys[key];\n  }\n\n  setColumnKey(key, value) {\n    this._keys[key] = value;\n  }\n\n  deleteColumnKey(key) {\n    delete this._keys[key];\n  }\n\n  eachColumnKey(f) {\n    _.each(this._keys, f);\n  }\n\n  // get a single column by col number. If it doesn't exist, it and any gaps before it\n  // are created.\n  getColumn(c) {\n    if (typeof c === 'string') {\n      // if it matches a key'd column, return that\n      const col = this._keys[c];\n      if (col) return col;\n\n      // otherwise, assume letter\n      c = colCache.l2n(c);\n    }\n    if (!this._columns) {\n      this._columns = [];\n    }\n    if (c > this._columns.length) {\n      let n = this._columns.length + 1;\n      while (n <= c) {\n        this._columns.push(new Column(this, n++));\n      }\n    }\n    return this._columns[c - 1];\n  }\n\n  // =========================================================================\n  // Rows\n  get _nextRow() {\n    return this._rowZero + this._rows.length;\n  }\n\n  // iterate over every uncommitted row in the worksheet, including maybe empty rows\n  eachRow(options, iteratee) {\n    if (!iteratee) {\n      iteratee = options;\n      options = undefined;\n    }\n    if (options && options.includeEmpty) {\n      const n = this._nextRow;\n      for (let i = this._rowZero; i < n; i++) {\n        iteratee(this.getRow(i), i);\n      }\n    } else {\n      this._rows.forEach(row => {\n        if (row.hasValues) {\n          iteratee(row, row.number);\n        }\n      });\n    }\n  }\n\n  _commitRow(cRow) {\n    // since rows must be written in order, we commit all rows up till and including cRow\n    let found = false;\n    while (this._rows.length && !found) {\n      const row = this._rows.shift();\n      this._rowZero++;\n      if (row) {\n        this._writeRow(row);\n        found = row.number === cRow.number;\n        this._rowZero = row.number + 1;\n      }\n    }\n  }\n\n  get lastRow() {\n    // returns last uncommitted row\n    if (this._rows.length) {\n      return this._rows[this._rows.length - 1];\n    }\n    return undefined;\n  }\n\n  // find a row (if exists) by row number\n  findRow(rowNumber) {\n    const index = rowNumber - this._rowZero;\n    return this._rows[index];\n  }\n\n  getRow(rowNumber) {\n    const index = rowNumber - this._rowZero;\n\n    // may fail if rows have been comitted\n    if (index < 0) {\n      throw new Error('Out of bounds: this row has been committed');\n    }\n    let row = this._rows[index];\n    if (!row) {\n      this._rows[index] = row = new Row(this, rowNumber);\n    }\n    return row;\n  }\n\n  addRow(value) {\n    const row = new Row(this, this._nextRow);\n    this._rows[row.number - this._rowZero] = row;\n    row.values = value;\n    return row;\n  }\n\n  // ================================================================================\n  // Cells\n\n  // returns the cell at [r,c] or address given by r. If not found, return undefined\n  findCell(r, c) {\n    const address = colCache.getAddress(r, c);\n    const row = this.findRow(address.row);\n    return row ? row.findCell(address.column) : undefined;\n  }\n\n  // return the cell at [r,c] or address given by r. If not found, create a new one.\n  getCell(r, c) {\n    const address = colCache.getAddress(r, c);\n    const row = this.getRow(address.row);\n    return row.getCellEx(address);\n  }\n\n  mergeCells(...cells) {\n    // may fail if rows have been comitted\n    const dimensions = new Dimensions(cells);\n\n    // check cells aren't already merged\n    this._merges.forEach(merge => {\n      if (merge.intersects(dimensions)) {\n        throw new Error('Cannot merge already merged cells');\n      }\n    });\n\n    // apply merge\n    const master = this.getCell(dimensions.top, dimensions.left);\n    for (let i = dimensions.top; i <= dimensions.bottom; i++) {\n      for (let j = dimensions.left; j <= dimensions.right; j++) {\n        if (i > dimensions.top || j > dimensions.left) {\n          this.getCell(i, j).merge(master);\n        }\n      }\n    }\n\n    // index merge\n    this._merges.push(dimensions);\n  }\n\n  // ===========================================================================\n  // Conditional Formatting\n  addConditionalFormatting(cf) {\n    this.conditionalFormatting.push(cf);\n  }\n\n  removeConditionalFormatting(filter) {\n    if (typeof filter === 'number') {\n      this.conditionalFormatting.splice(filter, 1);\n    } else if (filter instanceof Function) {\n      this.conditionalFormatting = this.conditionalFormatting.filter(filter);\n    } else {\n      this.conditionalFormatting = [];\n    }\n  }\n\n  // =========================================================================\n\n  addBackgroundImage(imageId) {\n    this._background = {\n      imageId,\n    };\n  }\n\n  getBackgroundImageId() {\n    return this._background && this._background.imageId;\n  }\n\n  // =========================================================================\n  // Worksheet Protection\n  protect(password, options) {\n    // TODO: make this function truly async\n    // perhaps marshal to worker thread or something\n    return new Promise(resolve => {\n      this.sheetProtection = {\n        sheet: true,\n      };\n      if (options && 'spinCount' in options) {\n        // force spinCount to be integer >= 0\n        options.spinCount = Number.isFinite(options.spinCount) ? Math.round(Math.max(0, options.spinCount)) : 100000;\n      }\n      if (password) {\n        this.sheetProtection.algorithmName = 'SHA-512';\n        this.sheetProtection.saltValue = Encryptor.randomBytes(16).toString('base64');\n        this.sheetProtection.spinCount = options && 'spinCount' in options ? options.spinCount : 100000; // allow user specified spinCount\n        this.sheetProtection.hashValue = Encryptor.convertPasswordToHash(\n          password,\n          'SHA512',\n          this.sheetProtection.saltValue,\n          this.sheetProtection.spinCount\n        );\n      }\n      if (options) {\n        this.sheetProtection = Object.assign(this.sheetProtection, options);\n        if (!password && 'spinCount' in options) {\n          delete this.sheetProtection.spinCount;\n        }\n      }\n      resolve();\n    });\n  }\n\n  unprotect() {\n    this.sheetProtection = null;\n  }\n\n  // ================================================================================\n\n  _write(text) {\n    xmlBuffer.reset();\n    xmlBuffer.addText(text);\n    this.stream.write(xmlBuffer);\n  }\n\n  _writeSheetProperties(xmlBuf, properties, pageSetup) {\n    const sheetPropertiesModel = {\n      outlineProperties: properties && properties.outlineProperties,\n      tabColor: properties && properties.tabColor,\n      pageSetup:\n        pageSetup && pageSetup.fitToPage\n          ? {\n              fitToPage: pageSetup.fitToPage,\n            }\n          : undefined,\n    };\n\n    xmlBuf.addText(xform.sheetProperties.toXml(sheetPropertiesModel));\n  }\n\n  _writeSheetFormatProperties(xmlBuf, properties) {\n    const sheetFormatPropertiesModel = properties\n      ? {\n          defaultRowHeight: properties.defaultRowHeight,\n          dyDescent: properties.dyDescent,\n          outlineLevelCol: properties.outlineLevelCol,\n          outlineLevelRow: properties.outlineLevelRow,\n        }\n      : undefined;\n    if (properties.defaultColWidth) {\n      sheetFormatPropertiesModel.defaultColWidth = properties.defaultColWidth;\n    }\n\n    xmlBuf.addText(xform.sheetFormatProperties.toXml(sheetFormatPropertiesModel));\n  }\n\n  _writeOpenWorksheet() {\n    xmlBuffer.reset();\n\n    xmlBuffer.addText('<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?>');\n    xmlBuffer.addText(\n      '<worksheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\"' +\n        ' xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"' +\n        ' xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"' +\n        ' mc:Ignorable=\"x14ac\"' +\n        ' xmlns:x14ac=\"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\">'\n    );\n\n    this._writeSheetProperties(xmlBuffer, this.properties, this.pageSetup);\n\n    xmlBuffer.addText(xform.sheetViews.toXml(this.views));\n\n    this._writeSheetFormatProperties(xmlBuffer, this.properties);\n\n    this.stream.write(xmlBuffer);\n  }\n\n  _writeColumns() {\n    const cols = Column.toModel(this.columns);\n    if (cols) {\n      xform.columns.prepare(cols, {styles: this._workbook.styles});\n      this.stream.write(xform.columns.toXml(cols));\n    }\n  }\n\n  _writeOpenSheetData() {\n    this._write('<sheetData>');\n  }\n\n  _writeRow(row) {\n    if (!this.startedData) {\n      this._writeColumns();\n      this._writeOpenSheetData();\n      this.startedData = true;\n    }\n\n    if (row.hasValues || row.height) {\n      const {model} = row;\n      const options = {\n        styles: this._workbook.styles,\n        sharedStrings: this.useSharedStrings ? this._workbook.sharedStrings : undefined,\n        hyperlinks: this._sheetRelsWriter.hyperlinksProxy,\n        merges: this._merges,\n        formulae: this._formulae,\n        siFormulae: this._siFormulae,\n        comments: [],\n      };\n      xform.row.prepare(model, options);\n      this.stream.write(xform.row.toXml(model));\n\n      if (options.comments.length) {\n        this.hasComments = true;\n        this._sheetCommentsWriter.addComments(options.comments);\n      }\n    }\n  }\n\n  _writeCloseSheetData() {\n    this._write('</sheetData>');\n  }\n\n  _writeMergeCells() {\n    if (this._merges.length) {\n      xmlBuffer.reset();\n      xmlBuffer.addText(`<mergeCells count=\"${this._merges.length}\">`);\n      this._merges.forEach(merge => {\n        xmlBuffer.addText(`<mergeCell ref=\"${merge}\"/>`);\n      });\n      xmlBuffer.addText('</mergeCells>');\n\n      this.stream.write(xmlBuffer);\n    }\n  }\n\n  _writeHyperlinks() {\n    // eslint-disable-next-line no-underscore-dangle\n    this.stream.write(xform.hyperlinks.toXml(this._sheetRelsWriter._hyperlinks));\n  }\n\n  _writeConditionalFormatting() {\n    const options = {\n      styles: this._workbook.styles,\n    };\n    xform.conditionalFormattings.prepare(this.conditionalFormatting, options);\n    this.stream.write(xform.conditionalFormattings.toXml(this.conditionalFormatting));\n  }\n\n  _writeRowBreaks() {\n    this.stream.write(xform.rowBreaks.toXml(this.rowBreaks));\n  }\n\n  _writeDataValidations() {\n    this.stream.write(xform.dataValidations.toXml(this.dataValidations.model));\n  }\n\n  _writeSheetProtection() {\n    this.stream.write(xform.sheetProtection.toXml(this.sheetProtection));\n  }\n\n  _writePageMargins() {\n    this.stream.write(xform.pageMargins.toXml(this.pageSetup.margins));\n  }\n\n  _writePageSetup() {\n    this.stream.write(xform.pageSeteup.toXml(this.pageSetup));\n  }\n\n  _writeHeaderFooter() {\n    this.stream.write(xform.headerFooter.toXml(this.headerFooter));\n  }\n\n  _writeAutoFilter() {\n    this.stream.write(xform.autoFilter.toXml(this.autoFilter));\n  }\n\n  _writeBackground() {\n    if (this._background) {\n      if (this._background.imageId !== undefined) {\n        const image = this._workbook.getImage(this._background.imageId);\n        const pictureId = this._sheetRelsWriter.addMedia({\n          Target: `../media/${image.name}`,\n          Type: RelType.Image,\n        });\n\n        this._background = {\n          ...this._background,\n          rId: pictureId,\n        };\n      }\n      this.stream.write(xform.picture.toXml({rId: this._background.rId}));\n    }\n  }\n\n  _writeLegacyData() {\n    if (this.hasComments) {\n      xmlBuffer.reset();\n      xmlBuffer.addText(`<legacyDrawing r:id=\"${this._sheetCommentsWriter.vmlRelId}\"/>`);\n      this.stream.write(xmlBuffer);\n    }\n  }\n\n  _writeDimensions() {\n    // for some reason, Excel can't handle dimensions at the bottom of the file\n    // and we don't know the dimensions until the commit, so don't write them.\n    // this._write('<dimension ref=\"' + this._dimensions + '\"/>');\n  }\n\n  _writeCloseWorksheet() {\n    this._write('</worksheet>');\n  }\n}\n\nmodule.exports = WorksheetWriter;\n"],"mappings":";;;;;;;;;;;AAAA,IAAMA,CAAC,GAAGC,OAAO,CAAC,wBAAwB,CAAC;AAE3C,IAAMC,OAAO,GAAGD,OAAO,CAAC,qBAAqB,CAAC;AAE9C,IAAME,QAAQ,GAAGF,OAAO,CAAC,uBAAuB,CAAC;AACjD,IAAMG,SAAS,GAAGH,OAAO,CAAC,uBAAuB,CAAC;AAClD,IAAMI,UAAU,GAAGJ,OAAO,CAAC,iBAAiB,CAAC;AAC7C,IAAMK,SAAS,GAAGL,OAAO,CAAC,wBAAwB,CAAC;AAEnD,IAAMM,GAAG,GAAGN,OAAO,CAAC,eAAe,CAAC;AACpC,IAAMO,MAAM,GAAGP,OAAO,CAAC,kBAAkB,CAAC;AAE1C,IAAMQ,eAAe,GAAGR,OAAO,CAAC,qBAAqB,CAAC;AACtD,IAAMS,mBAAmB,GAAGT,OAAO,CAAC,yBAAyB,CAAC;AAC9D,IAAMU,eAAe,GAAGV,OAAO,CAAC,4BAA4B,CAAC;AAE7D,IAAMW,SAAS,GAAG,IAAIN,SAAS,CAAC,CAAC;;AAEjC;AACA;AACA,IAAMO,SAAS,GAAGZ,OAAO,CAAC,6BAA6B,CAAC;AACxD,IAAMa,oBAAoB,GAAGb,OAAO,CAAC,+CAA+C,CAAC;AACrF,IAAMc,oBAAoB,GAAGd,OAAO,CAAC,+CAA+C,CAAC;AACrF,IAAMe,0BAA0B,GAAGf,OAAO,CAAC,sDAAsD,CAAC;AAClG,IAAMgB,QAAQ,GAAGhB,OAAO,CAAC,kCAAkC,CAAC;AAC5D,IAAMiB,QAAQ,GAAGjB,OAAO,CAAC,kCAAkC,CAAC;AAC5D,IAAMkB,cAAc,GAAGlB,OAAO,CAAC,wCAAwC,CAAC;AACxE,IAAMmB,cAAc,GAAGnB,OAAO,CAAC,yCAAyC,CAAC;AACzE,IAAMoB,oBAAoB,GAAGpB,OAAO,CAAC,+CAA+C,CAAC;AACrF,IAAMqB,gBAAgB,GAAGrB,OAAO,CAAC,2CAA2C,CAAC;AAC7E,IAAMsB,cAAc,GAAGtB,OAAO,CAAC,yCAAyC,CAAC;AACzE,IAAMuB,eAAe,GAAGvB,OAAO,CAAC,0CAA0C,CAAC;AAC3E,IAAMwB,YAAY,GAAGxB,OAAO,CAAC,sCAAsC,CAAC;AACpE,IAAMyB,2BAA2B,GAAGzB,OAAO,CAAC,yDAAyD,CAAC;AACtG,IAAM0B,iBAAiB,GAAG1B,OAAO,CAAC,4CAA4C,CAAC;AAC/E,IAAM2B,cAAc,GAAG3B,OAAO,CAAC,yCAAyC,CAAC;;AAEzE;AACA,IAAM4B,KAAK,GAAG;EACZC,eAAe,EAAE,IAAIhB,oBAAoB,CAAC,CAAC;EAC3CiB,eAAe,EAAE,IAAIhB,oBAAoB,CAAC,CAAC;EAC3CiB,qBAAqB,EAAE,IAAIhB,0BAA0B,CAAC,CAAC;EACvDiB,OAAO,EAAE,IAAIpB,SAAS,CAAC;IAACqB,GAAG,EAAE,MAAM;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,IAAInB,QAAQ,CAAC;EAAC,CAAC,CAAC;EAChFoB,GAAG,EAAE,IAAInB,QAAQ,CAAC,CAAC;EACnBoB,UAAU,EAAE,IAAIzB,SAAS,CAAC;IAACqB,GAAG,EAAE,YAAY;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,IAAIjB,cAAc,CAAC;EAAC,CAAC,CAAC;EAC/FoB,UAAU,EAAE,IAAI1B,SAAS,CAAC;IAACqB,GAAG,EAAE,YAAY;IAAEC,MAAM,EAAE,KAAK;IAAEC,UAAU,EAAE,IAAIhB,cAAc,CAAC;EAAC,CAAC,CAAC;EAC/FoB,eAAe,EAAE,IAAInB,oBAAoB,CAAC,CAAC;EAC3CoB,WAAW,EAAE,IAAInB,gBAAgB,CAAC,CAAC;EACnCoB,UAAU,EAAE,IAAInB,cAAc,CAAC,CAAC;EAChCoB,UAAU,EAAE,IAAInB,eAAe,CAAC,CAAC;EACjCoB,OAAO,EAAE,IAAInB,YAAY,CAAC,CAAC;EAC3BoB,sBAAsB,EAAE,IAAInB,2BAA2B,CAAC,CAAC;EACzDoB,YAAY,EAAE,IAAInB,iBAAiB,CAAC,CAAC;EACrCoB,SAAS,EAAE,IAAInB,cAAc,CAAC;AAChC,CAAC;;AAED;AAAA,IAEMoB,eAAe;EACnB,SAAAA,gBAAYC,OAAO,EAAE;IAAAC,eAAA,OAAAF,eAAA;IACnB;IACA,IAAI,CAACG,EAAE,GAAGF,OAAO,CAACE,EAAE;;IAEpB;IACA,IAAI,CAACC,IAAI,GAAGH,OAAO,CAACG,IAAI,YAAAC,MAAA,CAAY,IAAI,CAACF,EAAE,CAAE;;IAE7C;IACA,IAAI,CAACG,KAAK,GAAGL,OAAO,CAACK,KAAK,IAAI,SAAS;;IAEvC;IACA;IACA,IAAI,CAACC,KAAK,GAAG,EAAE;;IAEf;IACA,IAAI,CAACC,QAAQ,GAAG,IAAI;;IAEpB;IACA,IAAI,CAACC,KAAK,GAAG,CAAC,CAAC;;IAEf;IACA,IAAI,CAACC,OAAO,GAAG,EAAE;IACjB,IAAI,CAACA,OAAO,CAACC,GAAG,GAAG,YAAW,CAAC,CAAC,CAAC,CAAC;;IAElC;IACA,IAAI,CAACC,gBAAgB,GAAG,IAAInD,eAAe,CAACwC,OAAO,CAAC;IAEpD,IAAI,CAACY,oBAAoB,GAAG,IAAInD,mBAAmB,CAAC,IAAI,EAAE,IAAI,CAACkD,gBAAgB,EAAEX,OAAO,CAAC;;IAEzF;IACA,IAAI,CAACa,WAAW,GAAG,IAAIzD,UAAU,CAAC,CAAC;;IAEnC;IACA,IAAI,CAAC0D,QAAQ,GAAG,CAAC;;IAEjB;IACA,IAAI,CAACC,SAAS,GAAG,KAAK;;IAEtB;IACA,IAAI,CAAClC,eAAe,GAAG,IAAInB,eAAe,CAAC,CAAC;;IAE5C;IACA,IAAI,CAACsD,SAAS,GAAG,CAAC,CAAC;IACnB,IAAI,CAACC,WAAW,GAAG,CAAC;;IAEpB;IACA,IAAI,CAACC,qBAAqB,GAAG,EAAE;;IAE/B;IACA,IAAI,CAACpB,SAAS,GAAG,EAAE;;IAEnB;IACA,IAAI,CAACqB,UAAU,GAAGC,MAAM,CAACC,MAAM,CAC7B,CAAC,CAAC,EACF;MACEC,gBAAgB,EAAE,EAAE;MACpBC,SAAS,EAAE,EAAE;MACbC,eAAe,EAAE,CAAC;MAClBC,eAAe,EAAE;IACnB,CAAC,EACDzB,OAAO,CAACmB,UACV,CAAC;IAED,IAAI,CAACtB,YAAY,GAAGuB,MAAM,CAACC,MAAM,CAC/B,CAAC,CAAC,EACF;MACEK,cAAc,EAAE,KAAK;MACrBC,gBAAgB,EAAE,KAAK;MACvBC,SAAS,EAAE,IAAI;MACfC,SAAS,EAAE,IAAI;MACfC,UAAU,EAAE,IAAI;MAChBC,UAAU,EAAE,IAAI;MAChBC,WAAW,EAAE,IAAI;MACjBC,WAAW,EAAE;IACf,CAAC,EACDjC,OAAO,CAACH,YACV,CAAC;;IAED;IACA,IAAI,CAACqC,SAAS,GAAGd,MAAM,CAACC,MAAM,CAC5B,CAAC,CAAC,EACF;MACEc,OAAO,EAAE;QAACC,IAAI,EAAE,GAAG;QAAEC,KAAK,EAAE,GAAG;QAAEC,GAAG,EAAE,IAAI;QAAEC,MAAM,EAAE,IAAI;QAAEC,MAAM,EAAE,GAAG;QAAEC,MAAM,EAAE;MAAG,CAAC;MACnFC,WAAW,EAAE,UAAU;MACvBC,aAAa,EAAE,UAAU;MACzBC,WAAW,EAAE,UAAU;MACvBC,SAAS,EAAE,CAAC,EACV7C,OAAO,CAACkC,SAAS,KAChBlC,OAAO,CAACkC,SAAS,CAACY,UAAU,IAAI9C,OAAO,CAACkC,SAAS,CAACa,WAAW,CAAC,IAC/D,CAAC/C,OAAO,CAACkC,SAAS,CAACc,KAAK,CACzB;MACDC,SAAS,EAAE,cAAc;MACzBC,aAAa,EAAE,KAAK;MACpBC,KAAK,EAAE,KAAK;MACZC,YAAY,EAAE,MAAM;MACpBC,MAAM,EAAE,WAAW;MACnBL,KAAK,EAAE,GAAG;MACVF,UAAU,EAAE,CAAC;MACbC,WAAW,EAAE,CAAC;MACdO,SAAS,EAAEC,SAAS;MACpBC,iBAAiB,EAAE,KAAK;MACxBC,aAAa,EAAE,KAAK;MACpBC,kBAAkB,EAAE,KAAK;MACzBC,gBAAgB,EAAE,KAAK;MACvB7D,SAAS,EAAE,IAAI;MACf8D,SAAS,EAAE;IACb,CAAC,EACD5D,OAAO,CAACkC,SACV,CAAC;;IAED;IACA,IAAI,CAAC2B,gBAAgB,GAAG7D,OAAO,CAAC6D,gBAAgB,IAAI,KAAK;IAEzD,IAAI,CAACC,SAAS,GAAG9D,OAAO,CAAC+D,QAAQ;IAEjC,IAAI,CAACC,WAAW,GAAG,KAAK;;IAExB;IACA,IAAI,CAACC,MAAM,GAAGjE,OAAO,CAACkE,KAAK,IAAI,EAAE;;IAEjC;IACA,IAAI,CAACxE,UAAU,GAAGM,OAAO,CAACN,UAAU,IAAI,IAAI;IAE5C,IAAI,CAACyE,MAAM,GAAG,EAAE;;IAEhB;IACA,IAAI,CAAC5E,eAAe,GAAG,IAAI;;IAE3B;IACA,IAAI,CAAC6E,mBAAmB,CAAC,CAAC;IAE1B,IAAI,CAACC,WAAW,GAAG,KAAK;EAC1B;EAACC,YAAA,CAAAvE,eAAA;IAAAwE,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAe;MACb,OAAO,IAAI,CAACV,SAAS;IACvB;EAAC;IAAAS,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAa;MACX,IAAI,CAAC,IAAI,CAACC,OAAO,EAAE;QACjB;QACA,IAAI,CAACA,OAAO,GAAG,IAAI,CAACX,SAAS,CAACY,WAAW,wBAAAtE,MAAA,CAAwB,IAAI,CAACF,EAAE,SAAM,CAAC;;QAE/E;QACA,IAAI,CAACuE,OAAO,CAACE,KAAK,CAAC,CAAC;MACtB;MACA,OAAO,IAAI,CAACF,OAAO;IACrB;;IAEA;IACA;EAAA;IAAAF,GAAA;IAAAK,KAAA,EACA,SAAAC,QAAA,EAAU;MACR,MAAM,IAAIC,KAAK,CAAC,4BAA4B,CAAC;IAC/C;EAAC;IAAAP,GAAA;IAAAK,KAAA,EAED,SAAAG,OAAA,EAAS;MAAA,IAAAC,KAAA;MACP,IAAI,IAAI,CAACjE,SAAS,EAAE;QAClB;MACF;MACA;MACA,IAAI,CAACT,KAAK,CAAC2E,OAAO,CAAC,UAAAC,IAAI,EAAI;QACzB,IAAIA,IAAI,EAAE;UACR;UACAF,KAAI,CAACG,SAAS,CAACD,IAAI,CAAC;QACtB;MACF,CAAC,CAAC;;MAEF;MACA,IAAI,CAAC5E,KAAK,GAAG,IAAI;MAEjB,IAAI,CAAC,IAAI,CAAC+D,WAAW,EAAE;QACrB,IAAI,CAACe,mBAAmB,CAAC,CAAC;MAC5B;MACA,IAAI,CAACC,oBAAoB,CAAC,CAAC;MAC3B,IAAI,CAACC,gBAAgB,CAAC,CAAC;MACvB,IAAI,CAACC,gBAAgB,CAAC,CAAC;;MAEvB;MACA;;MAEA,IAAI,CAACC,gBAAgB,CAAC,CAAC;MACvB,IAAI,CAACC,2BAA2B,CAAC,CAAC;MAClC,IAAI,CAACC,qBAAqB,CAAC,CAAC;MAC5B,IAAI,CAACC,qBAAqB,CAAC,CAAC;MAC5B,IAAI,CAACC,iBAAiB,CAAC,CAAC;MACxB,IAAI,CAACC,eAAe,CAAC,CAAC;MACtB,IAAI,CAACC,gBAAgB,CAAC,CAAC;MACvB,IAAI,CAACC,kBAAkB,CAAC,CAAC;MACzB,IAAI,CAACC,eAAe,CAAC,CAAC;;MAEtB;MACA,IAAI,CAACC,gBAAgB,CAAC,CAAC;MAEvB,IAAI,CAACC,oBAAoB,CAAC,CAAC;MAC3B;MACA,IAAI,CAACC,MAAM,CAACC,GAAG,CAAC,CAAC;MAEjB,IAAI,CAACxF,oBAAoB,CAACmE,MAAM,CAAC,CAAC;MAClC;MACA,IAAI,CAACpE,gBAAgB,CAACoE,MAAM,CAAC,CAAC;MAE9B,IAAI,CAAChE,SAAS,GAAG,IAAI;IACvB;;IAEA;EAAA;IAAAwD,GAAA;IAAAC,GAAA,EACA,SAAAA,IAAA,EAAiB;MACf,OAAO,IAAI,CAAC3D,WAAW;IACzB;EAAC;IAAA0D,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAY;MACV,OAAO,IAAI,CAACP,MAAM;IACpB;;IAEA;IACA;;IAEA;EAAA;IAAAM,GAAA;IAAAC,GAAA,EACA,SAAAA,IAAA,EAAc;MACZ,OAAO,IAAI,CAACjE,QAAQ;IACtB;;IAEA;IACA;IAAA;IAAA8F,GAAA,EACA,SAAAA,IAAYzB,KAAK,EAAE;MAAA,IAAA0B,MAAA;MACjB;MACA,IAAI,CAACC,eAAe,GAAG3B,KAAK,CAAC4B,MAAM,CAAC,UAACC,EAAE,EAAEC,EAAE,EAAK;QAC9C,IAAMC,WAAW,GAAID,EAAE,CAAClE,MAAM,IAAI,CAAC,IAAMkE,EAAE,CAACE,OAAO,IAAIF,EAAE,CAACE,OAAO,CAAC1H,MAAO,IAAI,CAAC;QAC9E,OAAO2H,IAAI,CAACC,GAAG,CAACL,EAAE,EAAEE,WAAW,CAAC;MAClC,CAAC,EAAE,CAAC,CAAC;;MAEL;MACA,IAAII,KAAK,GAAG,CAAC;MACb,IAAM/H,OAAO,GAAI,IAAI,CAACuB,QAAQ,GAAG,EAAG;MACpCqE,KAAK,CAACK,OAAO,CAAC,UAAA+B,IAAI,EAAI;QACpB,IAAMC,MAAM,GAAG,IAAI1J,MAAM,CAAC+I,MAAI,EAAES,KAAK,EAAE,EAAE,KAAK,CAAC;QAC/C/H,OAAO,CAACkI,IAAI,CAACD,MAAM,CAAC;QACpBA,MAAM,CAACD,IAAI,GAAGA,IAAI;MACpB,CAAC,CAAC;IACJ;EAAC;IAAAzC,GAAA;IAAAK,KAAA,EAED,SAAAuC,aAAa5C,GAAG,EAAE;MAChB,OAAO,IAAI,CAAC/D,KAAK,CAAC+D,GAAG,CAAC;IACxB;EAAC;IAAAA,GAAA;IAAAK,KAAA,EAED,SAAAwC,aAAa7C,GAAG,EAAEK,KAAK,EAAE;MACvB,IAAI,CAACpE,KAAK,CAAC+D,GAAG,CAAC,GAAGK,KAAK;IACzB;EAAC;IAAAL,GAAA;IAAAK,KAAA,EAED,SAAAyC,gBAAgB9C,GAAG,EAAE;MACnB,OAAO,IAAI,CAAC/D,KAAK,CAAC+D,GAAG,CAAC;IACxB;EAAC;IAAAA,GAAA;IAAAK,KAAA,EAED,SAAA0C,cAAcC,CAAC,EAAE;MACfxK,CAAC,CAACyK,IAAI,CAAC,IAAI,CAAChH,KAAK,EAAE+G,CAAC,CAAC;IACvB;;IAEA;IACA;EAAA;IAAAhD,GAAA;IAAAK,KAAA,EACA,SAAA6C,UAAUC,CAAC,EAAE;MACX,IAAI,OAAOA,CAAC,KAAK,QAAQ,EAAE;QACzB;QACA,IAAMC,GAAG,GAAG,IAAI,CAACnH,KAAK,CAACkH,CAAC,CAAC;QACzB,IAAIC,GAAG,EAAE,OAAOA,GAAG;;QAEnB;QACAD,CAAC,GAAGxK,QAAQ,CAAC0K,GAAG,CAACF,CAAC,CAAC;MACrB;MACA,IAAI,CAAC,IAAI,CAACnH,QAAQ,EAAE;QAClB,IAAI,CAACA,QAAQ,GAAG,EAAE;MACpB;MACA,IAAImH,CAAC,GAAG,IAAI,CAACnH,QAAQ,CAACrB,MAAM,EAAE;QAC5B,IAAI2I,CAAC,GAAG,IAAI,CAACtH,QAAQ,CAACrB,MAAM,GAAG,CAAC;QAChC,OAAO2I,CAAC,IAAIH,CAAC,EAAE;UACb,IAAI,CAACnH,QAAQ,CAAC2G,IAAI,CAAC,IAAI3J,MAAM,CAAC,IAAI,EAAEsK,CAAC,EAAE,CAAC,CAAC;QAC3C;MACF;MACA,OAAO,IAAI,CAACtH,QAAQ,CAACmH,CAAC,GAAG,CAAC,CAAC;IAC7B;;IAEA;IACA;EAAA;IAAAnD,GAAA;IAAAC,GAAA,EACA,SAAAA,IAAA,EAAe;MACb,OAAO,IAAI,CAAC1D,QAAQ,GAAG,IAAI,CAACR,KAAK,CAACpB,MAAM;IAC1C;;IAEA;EAAA;IAAAqF,GAAA;IAAAK,KAAA,EACA,SAAAkD,QAAQ9H,OAAO,EAAE+H,QAAQ,EAAE;MACzB,IAAI,CAACA,QAAQ,EAAE;QACbA,QAAQ,GAAG/H,OAAO;QAClBA,OAAO,GAAGuD,SAAS;MACrB;MACA,IAAIvD,OAAO,IAAIA,OAAO,CAACgI,YAAY,EAAE;QACnC,IAAMH,CAAC,GAAG,IAAI,CAACI,QAAQ;QACvB,KAAK,IAAIC,CAAC,GAAG,IAAI,CAACpH,QAAQ,EAAEoH,CAAC,GAAGL,CAAC,EAAEK,CAAC,EAAE,EAAE;UACtCH,QAAQ,CAAC,IAAI,CAACI,MAAM,CAACD,CAAC,CAAC,EAAEA,CAAC,CAAC;QAC7B;MACF,CAAC,MAAM;QACL,IAAI,CAAC5H,KAAK,CAAC2E,OAAO,CAAC,UAAA7F,GAAG,EAAI;UACxB,IAAIA,GAAG,CAACgJ,SAAS,EAAE;YACjBL,QAAQ,CAAC3I,GAAG,EAAEA,GAAG,CAACiJ,MAAM,CAAC;UAC3B;QACF,CAAC,CAAC;MACJ;IACF;EAAC;IAAA9D,GAAA;IAAAK,KAAA,EAED,SAAA0D,WAAWpD,IAAI,EAAE;MACf;MACA,IAAIqD,KAAK,GAAG,KAAK;MACjB,OAAO,IAAI,CAACjI,KAAK,CAACpB,MAAM,IAAI,CAACqJ,KAAK,EAAE;QAClC,IAAMnJ,GAAG,GAAG,IAAI,CAACkB,KAAK,CAACkI,KAAK,CAAC,CAAC;QAC9B,IAAI,CAAC1H,QAAQ,EAAE;QACf,IAAI1B,GAAG,EAAE;UACP,IAAI,CAAC+F,SAAS,CAAC/F,GAAG,CAAC;UACnBmJ,KAAK,GAAGnJ,GAAG,CAACiJ,MAAM,KAAKnD,IAAI,CAACmD,MAAM;UAClC,IAAI,CAACvH,QAAQ,GAAG1B,GAAG,CAACiJ,MAAM,GAAG,CAAC;QAChC;MACF;IACF;EAAC;IAAA9D,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAc;MACZ;MACA,IAAI,IAAI,CAAClE,KAAK,CAACpB,MAAM,EAAE;QACrB,OAAO,IAAI,CAACoB,KAAK,CAAC,IAAI,CAACA,KAAK,CAACpB,MAAM,GAAG,CAAC,CAAC;MAC1C;MACA,OAAOqE,SAAS;IAClB;;IAEA;EAAA;IAAAgB,GAAA;IAAAK,KAAA,EACA,SAAA6D,QAAQC,SAAS,EAAE;MACjB,IAAMC,KAAK,GAAGD,SAAS,GAAG,IAAI,CAAC5H,QAAQ;MACvC,OAAO,IAAI,CAACR,KAAK,CAACqI,KAAK,CAAC;IAC1B;EAAC;IAAApE,GAAA;IAAAK,KAAA,EAED,SAAAuD,OAAOO,SAAS,EAAE;MAChB,IAAMC,KAAK,GAAGD,SAAS,GAAG,IAAI,CAAC5H,QAAQ;;MAEvC;MACA,IAAI6H,KAAK,GAAG,CAAC,EAAE;QACb,MAAM,IAAI7D,KAAK,CAAC,4CAA4C,CAAC;MAC/D;MACA,IAAI1F,GAAG,GAAG,IAAI,CAACkB,KAAK,CAACqI,KAAK,CAAC;MAC3B,IAAI,CAACvJ,GAAG,EAAE;QACR,IAAI,CAACkB,KAAK,CAACqI,KAAK,CAAC,GAAGvJ,GAAG,GAAG,IAAI9B,GAAG,CAAC,IAAI,EAAEoL,SAAS,CAAC;MACpD;MACA,OAAOtJ,GAAG;IACZ;EAAC;IAAAmF,GAAA;IAAAK,KAAA,EAED,SAAAgE,OAAOhE,KAAK,EAAE;MACZ,IAAMxF,GAAG,GAAG,IAAI9B,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC2K,QAAQ,CAAC;MACxC,IAAI,CAAC3H,KAAK,CAAClB,GAAG,CAACiJ,MAAM,GAAG,IAAI,CAACvH,QAAQ,CAAC,GAAG1B,GAAG;MAC5CA,GAAG,CAACyJ,MAAM,GAAGjE,KAAK;MAClB,OAAOxF,GAAG;IACZ;;IAEA;IACA;;IAEA;EAAA;IAAAmF,GAAA;IAAAK,KAAA,EACA,SAAAkE,SAASC,CAAC,EAAErB,CAAC,EAAE;MACb,IAAMsB,OAAO,GAAG9L,QAAQ,CAAC+L,UAAU,CAACF,CAAC,EAAErB,CAAC,CAAC;MACzC,IAAMtI,GAAG,GAAG,IAAI,CAACqJ,OAAO,CAACO,OAAO,CAAC5J,GAAG,CAAC;MACrC,OAAOA,GAAG,GAAGA,GAAG,CAAC0J,QAAQ,CAACE,OAAO,CAAC/B,MAAM,CAAC,GAAG1D,SAAS;IACvD;;IAEA;EAAA;IAAAgB,GAAA;IAAAK,KAAA,EACA,SAAAsE,QAAQH,CAAC,EAAErB,CAAC,EAAE;MACZ,IAAMsB,OAAO,GAAG9L,QAAQ,CAAC+L,UAAU,CAACF,CAAC,EAAErB,CAAC,CAAC;MACzC,IAAMtI,GAAG,GAAG,IAAI,CAAC+I,MAAM,CAACa,OAAO,CAAC5J,GAAG,CAAC;MACpC,OAAOA,GAAG,CAAC+J,SAAS,CAACH,OAAO,CAAC;IAC/B;EAAC;IAAAzE,GAAA;IAAAK,KAAA,EAED,SAAAwE,WAAA,EAAqB;MAAA,SAAAC,IAAA,GAAAC,SAAA,CAAApK,MAAA,EAAPqK,KAAK,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;QAALF,KAAK,CAAAE,IAAA,IAAAH,SAAA,CAAAG,IAAA;MAAA;MACjB;MACA,IAAMC,UAAU,GAAG,IAAItM,UAAU,CAACmM,KAAK,CAAC;;MAExC;MACA,IAAI,CAAC9I,OAAO,CAACwE,OAAO,CAAC,UAAA0E,KAAK,EAAI;QAC5B,IAAIA,KAAK,CAACC,UAAU,CAACF,UAAU,CAAC,EAAE;UAChC,MAAM,IAAI5E,KAAK,CAAC,mCAAmC,CAAC;QACtD;MACF,CAAC,CAAC;;MAEF;MACA,IAAM+E,MAAM,GAAG,IAAI,CAACX,OAAO,CAACQ,UAAU,CAACpH,GAAG,EAAEoH,UAAU,CAACtH,IAAI,CAAC;MAC5D,KAAK,IAAI8F,CAAC,GAAGwB,UAAU,CAACpH,GAAG,EAAE4F,CAAC,IAAIwB,UAAU,CAACnH,MAAM,EAAE2F,CAAC,EAAE,EAAE;QACxD,KAAK,IAAI4B,CAAC,GAAGJ,UAAU,CAACtH,IAAI,EAAE0H,CAAC,IAAIJ,UAAU,CAACrH,KAAK,EAAEyH,CAAC,EAAE,EAAE;UACxD,IAAI5B,CAAC,GAAGwB,UAAU,CAACpH,GAAG,IAAIwH,CAAC,GAAGJ,UAAU,CAACtH,IAAI,EAAE;YAC7C,IAAI,CAAC8G,OAAO,CAAChB,CAAC,EAAE4B,CAAC,CAAC,CAACH,KAAK,CAACE,MAAM,CAAC;UAClC;QACF;MACF;;MAEA;MACA,IAAI,CAACpJ,OAAO,CAACyG,IAAI,CAACwC,UAAU,CAAC;IAC/B;;IAEA;IACA;EAAA;IAAAnF,GAAA;IAAAK,KAAA,EACA,SAAAmF,yBAAyBC,EAAE,EAAE;MAC3B,IAAI,CAAC9I,qBAAqB,CAACgG,IAAI,CAAC8C,EAAE,CAAC;IACrC;EAAC;IAAAzF,GAAA;IAAAK,KAAA,EAED,SAAAqF,4BAA4BC,MAAM,EAAE;MAClC,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;QAC9B,IAAI,CAAChJ,qBAAqB,CAACiJ,MAAM,CAACD,MAAM,EAAE,CAAC,CAAC;MAC9C,CAAC,MAAM,IAAIA,MAAM,YAAYE,QAAQ,EAAE;QACrC,IAAI,CAAClJ,qBAAqB,GAAG,IAAI,CAACA,qBAAqB,CAACgJ,MAAM,CAACA,MAAM,CAAC;MACxE,CAAC,MAAM;QACL,IAAI,CAAChJ,qBAAqB,GAAG,EAAE;MACjC;IACF;;IAEA;EAAA;IAAAqD,GAAA;IAAAK,KAAA,EAEA,SAAAyF,mBAAmBC,OAAO,EAAE;MAC1B,IAAI,CAACC,WAAW,GAAG;QACjBD,OAAO,EAAPA;MACF,CAAC;IACH;EAAC;IAAA/F,GAAA;IAAAK,KAAA,EAED,SAAA4F,qBAAA,EAAuB;MACrB,OAAO,IAAI,CAACD,WAAW,IAAI,IAAI,CAACA,WAAW,CAACD,OAAO;IACrD;;IAEA;IACA;EAAA;IAAA/F,GAAA;IAAAK,KAAA,EACA,SAAA6F,QAAQC,QAAQ,EAAE1K,OAAO,EAAE;MAAA,IAAA2K,MAAA;MACzB;MACA;MACA,OAAO,IAAIC,OAAO,CAAC,UAAAC,OAAO,EAAI;QAC5BF,MAAI,CAACpL,eAAe,GAAG;UACrBuL,KAAK,EAAE;QACT,CAAC;QACD,IAAI9K,OAAO,IAAI,WAAW,IAAIA,OAAO,EAAE;UACrC;UACAA,OAAO,CAAC+K,SAAS,GAAGC,MAAM,CAACC,QAAQ,CAACjL,OAAO,CAAC+K,SAAS,CAAC,GAAGlE,IAAI,CAACqE,KAAK,CAACrE,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE9G,OAAO,CAAC+K,SAAS,CAAC,CAAC,GAAG,MAAM;QAC9G;QACA,IAAIL,QAAQ,EAAE;UACZC,MAAI,CAACpL,eAAe,CAAC4L,aAAa,GAAG,SAAS;UAC9CR,MAAI,CAACpL,eAAe,CAAC6L,SAAS,GAAGjO,SAAS,CAACkO,WAAW,CAAC,EAAE,CAAC,CAACC,QAAQ,CAAC,QAAQ,CAAC;UAC7EX,MAAI,CAACpL,eAAe,CAACwL,SAAS,GAAG/K,OAAO,IAAI,WAAW,IAAIA,OAAO,GAAGA,OAAO,CAAC+K,SAAS,GAAG,MAAM,CAAC,CAAC;UACjGJ,MAAI,CAACpL,eAAe,CAACgM,SAAS,GAAGpO,SAAS,CAACqO,qBAAqB,CAC9Dd,QAAQ,EACR,QAAQ,EACRC,MAAI,CAACpL,eAAe,CAAC6L,SAAS,EAC9BT,MAAI,CAACpL,eAAe,CAACwL,SACvB,CAAC;QACH;QACA,IAAI/K,OAAO,EAAE;UACX2K,MAAI,CAACpL,eAAe,GAAG6B,MAAM,CAACC,MAAM,CAACsJ,MAAI,CAACpL,eAAe,EAAES,OAAO,CAAC;UACnE,IAAI,CAAC0K,QAAQ,IAAI,WAAW,IAAI1K,OAAO,EAAE;YACvC,OAAO2K,MAAI,CAACpL,eAAe,CAACwL,SAAS;UACvC;QACF;QACAF,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;IACJ;EAAC;IAAAtG,GAAA;IAAAK,KAAA,EAED,SAAA6G,UAAA,EAAY;MACV,IAAI,CAAClM,eAAe,GAAG,IAAI;IAC7B;;IAEA;EAAA;IAAAgF,GAAA;IAAAK,KAAA,EAEA,SAAA8G,OAAOC,IAAI,EAAE;MACXhO,SAAS,CAACiO,KAAK,CAAC,CAAC;MACjBjO,SAAS,CAACkO,OAAO,CAACF,IAAI,CAAC;MACvB,IAAI,CAACxF,MAAM,CAAC2F,KAAK,CAACnO,SAAS,CAAC;IAC9B;EAAC;IAAA4G,GAAA;IAAAK,KAAA,EAED,SAAAmH,sBAAsBC,MAAM,EAAE7K,UAAU,EAAEe,SAAS,EAAE;MACnD,IAAM+J,oBAAoB,GAAG;QAC3BC,iBAAiB,EAAE/K,UAAU,IAAIA,UAAU,CAAC+K,iBAAiB;QAC7DC,QAAQ,EAAEhL,UAAU,IAAIA,UAAU,CAACgL,QAAQ;QAC3CjK,SAAS,EACPA,SAAS,IAAIA,SAAS,CAACW,SAAS,GAC5B;UACEA,SAAS,EAAEX,SAAS,CAACW;QACvB,CAAC,GACDU;MACR,CAAC;MAEDyI,MAAM,CAACH,OAAO,CAACjN,KAAK,CAACE,eAAe,CAACsN,KAAK,CAACH,oBAAoB,CAAC,CAAC;IACnE;EAAC;IAAA1H,GAAA;IAAAK,KAAA,EAED,SAAAyH,4BAA4BL,MAAM,EAAE7K,UAAU,EAAE;MAC9C,IAAMmL,0BAA0B,GAAGnL,UAAU,GACzC;QACEG,gBAAgB,EAAEH,UAAU,CAACG,gBAAgB;QAC7CC,SAAS,EAAEJ,UAAU,CAACI,SAAS;QAC/BC,eAAe,EAAEL,UAAU,CAACK,eAAe;QAC3CC,eAAe,EAAEN,UAAU,CAACM;MAC9B,CAAC,GACD8B,SAAS;MACb,IAAIpC,UAAU,CAACoL,eAAe,EAAE;QAC9BD,0BAA0B,CAACC,eAAe,GAAGpL,UAAU,CAACoL,eAAe;MACzE;MAEAP,MAAM,CAACH,OAAO,CAACjN,KAAK,CAACG,qBAAqB,CAACqN,KAAK,CAACE,0BAA0B,CAAC,CAAC;IAC/E;EAAC;IAAA/H,GAAA;IAAAK,KAAA,EAED,SAAAR,oBAAA,EAAsB;MACpBzG,SAAS,CAACiO,KAAK,CAAC,CAAC;MAEjBjO,SAAS,CAACkO,OAAO,CAAC,yDAAyD,CAAC;MAC5ElO,SAAS,CAACkO,OAAO,CACf,8EAA8E,GAC5E,gFAAgF,GAChF,yEAAyE,GACzE,uBAAuB,GACvB,6EACJ,CAAC;MAED,IAAI,CAACE,qBAAqB,CAACpO,SAAS,EAAE,IAAI,CAACwD,UAAU,EAAE,IAAI,CAACe,SAAS,CAAC;MAEtEvE,SAAS,CAACkO,OAAO,CAACjN,KAAK,CAACU,UAAU,CAAC8M,KAAK,CAAC,IAAI,CAAClI,KAAK,CAAC,CAAC;MAErD,IAAI,CAACmI,2BAA2B,CAAC1O,SAAS,EAAE,IAAI,CAACwD,UAAU,CAAC;MAE5D,IAAI,CAACgF,MAAM,CAAC2F,KAAK,CAACnO,SAAS,CAAC;IAC9B;EAAC;IAAA4G,GAAA;IAAAK,KAAA,EAED,SAAA4H,cAAA,EAAgB;MACd,IAAMC,IAAI,GAAGlP,MAAM,CAACmP,OAAO,CAAC,IAAI,CAAC1N,OAAO,CAAC;MACzC,IAAIyN,IAAI,EAAE;QACR7N,KAAK,CAACI,OAAO,CAAC2N,OAAO,CAACF,IAAI,EAAE;UAACG,MAAM,EAAE,IAAI,CAAC9I,SAAS,CAAC8I;QAAM,CAAC,CAAC;QAC5D,IAAI,CAACzG,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACI,OAAO,CAACoN,KAAK,CAACK,IAAI,CAAC,CAAC;MAC9C;IACF;EAAC;IAAAlI,GAAA;IAAAK,KAAA,EAED,SAAAQ,oBAAA,EAAsB;MACpB,IAAI,CAACsG,MAAM,CAAC,aAAa,CAAC;IAC5B;EAAC;IAAAnH,GAAA;IAAAK,KAAA,EAED,SAAAO,UAAU/F,GAAG,EAAE;MACb,IAAI,CAAC,IAAI,CAACiF,WAAW,EAAE;QACrB,IAAI,CAACmI,aAAa,CAAC,CAAC;QACpB,IAAI,CAACpH,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACf,WAAW,GAAG,IAAI;MACzB;MAEA,IAAIjF,GAAG,CAACgJ,SAAS,IAAIhJ,GAAG,CAACyN,MAAM,EAAE;QAC/B,IAAOC,KAAK,GAAI1N,GAAG,CAAZ0N,KAAK;QACZ,IAAM9M,OAAO,GAAG;UACd4M,MAAM,EAAE,IAAI,CAAC9I,SAAS,CAAC8I,MAAM;UAC7BG,aAAa,EAAE,IAAI,CAAClJ,gBAAgB,GAAG,IAAI,CAACC,SAAS,CAACiJ,aAAa,GAAGxJ,SAAS;UAC/ElE,UAAU,EAAE,IAAI,CAACsB,gBAAgB,CAACqM,eAAe;UACjDC,MAAM,EAAE,IAAI,CAACxM,OAAO;UACpByM,QAAQ,EAAE,IAAI,CAAClM,SAAS;UACxBmM,UAAU,EAAE,IAAI,CAAClM,WAAW;UAC5BmM,QAAQ,EAAE;QACZ,CAAC;QACDxO,KAAK,CAACQ,GAAG,CAACuN,OAAO,CAACG,KAAK,EAAE9M,OAAO,CAAC;QACjC,IAAI,CAACmG,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACQ,GAAG,CAACgN,KAAK,CAACU,KAAK,CAAC,CAAC;QAEzC,IAAI9M,OAAO,CAACoN,QAAQ,CAAClO,MAAM,EAAE;UAC3B,IAAI,CAAC8E,WAAW,GAAG,IAAI;UACvB,IAAI,CAACpD,oBAAoB,CAACyM,WAAW,CAACrN,OAAO,CAACoN,QAAQ,CAAC;QACzD;MACF;IACF;EAAC;IAAA7I,GAAA;IAAAK,KAAA,EAED,SAAAS,qBAAA,EAAuB;MACrB,IAAI,CAACqG,MAAM,CAAC,cAAc,CAAC;IAC7B;EAAC;IAAAnH,GAAA;IAAAK,KAAA,EAED,SAAAW,iBAAA,EAAmB;MACjB,IAAI,IAAI,CAAC9E,OAAO,CAACvB,MAAM,EAAE;QACvBvB,SAAS,CAACiO,KAAK,CAAC,CAAC;QACjBjO,SAAS,CAACkO,OAAO,wBAAAzL,MAAA,CAAuB,IAAI,CAACK,OAAO,CAACvB,MAAM,QAAI,CAAC;QAChE,IAAI,CAACuB,OAAO,CAACwE,OAAO,CAAC,UAAA0E,KAAK,EAAI;UAC5BhM,SAAS,CAACkO,OAAO,qBAAAzL,MAAA,CAAoBuJ,KAAK,SAAK,CAAC;QAClD,CAAC,CAAC;QACFhM,SAAS,CAACkO,OAAO,CAAC,eAAe,CAAC;QAElC,IAAI,CAAC1F,MAAM,CAAC2F,KAAK,CAACnO,SAAS,CAAC;MAC9B;IACF;EAAC;IAAA4G,GAAA;IAAAK,KAAA,EAED,SAAAY,iBAAA,EAAmB;MACjB;MACA,IAAI,CAACW,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACS,UAAU,CAAC+M,KAAK,CAAC,IAAI,CAACzL,gBAAgB,CAAC2M,WAAW,CAAC,CAAC;IAC9E;EAAC;IAAA/I,GAAA;IAAAK,KAAA,EAED,SAAAa,4BAAA,EAA8B;MAC5B,IAAMzF,OAAO,GAAG;QACd4M,MAAM,EAAE,IAAI,CAAC9I,SAAS,CAAC8I;MACzB,CAAC;MACDhO,KAAK,CAACgB,sBAAsB,CAAC+M,OAAO,CAAC,IAAI,CAACzL,qBAAqB,EAAElB,OAAO,CAAC;MACzE,IAAI,CAACmG,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACgB,sBAAsB,CAACwM,KAAK,CAAC,IAAI,CAAClL,qBAAqB,CAAC,CAAC;IACnF;EAAC;IAAAqD,GAAA;IAAAK,KAAA,EAED,SAAAoB,gBAAA,EAAkB;MAChB,IAAI,CAACG,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACkB,SAAS,CAACsM,KAAK,CAAC,IAAI,CAACtM,SAAS,CAAC,CAAC;IAC1D;EAAC;IAAAyE,GAAA;IAAAK,KAAA,EAED,SAAAc,sBAAA,EAAwB;MACtB,IAAI,CAACS,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACC,eAAe,CAACuN,KAAK,CAAC,IAAI,CAACvN,eAAe,CAACiO,KAAK,CAAC,CAAC;IAC5E;EAAC;IAAAvI,GAAA;IAAAK,KAAA,EAED,SAAAe,sBAAA,EAAwB;MACtB,IAAI,CAACQ,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACW,eAAe,CAAC6M,KAAK,CAAC,IAAI,CAAC7M,eAAe,CAAC,CAAC;IACtE;EAAC;IAAAgF,GAAA;IAAAK,KAAA,EAED,SAAAgB,kBAAA,EAAoB;MAClB,IAAI,CAACO,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACY,WAAW,CAAC4M,KAAK,CAAC,IAAI,CAAClK,SAAS,CAACC,OAAO,CAAC,CAAC;IACpE;EAAC;IAAAoC,GAAA;IAAAK,KAAA,EAED,SAAAiB,gBAAA,EAAkB;MAChB,IAAI,CAACM,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACa,UAAU,CAAC2M,KAAK,CAAC,IAAI,CAAClK,SAAS,CAAC,CAAC;IAC3D;EAAC;IAAAqC,GAAA;IAAAK,KAAA,EAED,SAAAmB,mBAAA,EAAqB;MACnB,IAAI,CAACI,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACiB,YAAY,CAACuM,KAAK,CAAC,IAAI,CAACvM,YAAY,CAAC,CAAC;IAChE;EAAC;IAAA0E,GAAA;IAAAK,KAAA,EAED,SAAAU,iBAAA,EAAmB;MACjB,IAAI,CAACa,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACc,UAAU,CAAC0M,KAAK,CAAC,IAAI,CAAC1M,UAAU,CAAC,CAAC;IAC5D;EAAC;IAAA6E,GAAA;IAAAK,KAAA,EAED,SAAAkB,iBAAA,EAAmB;MACjB,IAAI,IAAI,CAACyE,WAAW,EAAE;QACpB,IAAI,IAAI,CAACA,WAAW,CAACD,OAAO,KAAK/G,SAAS,EAAE;UAC1C,IAAMgK,KAAK,GAAG,IAAI,CAACzJ,SAAS,CAAC0J,QAAQ,CAAC,IAAI,CAACjD,WAAW,CAACD,OAAO,CAAC;UAC/D,IAAMmD,SAAS,GAAG,IAAI,CAAC9M,gBAAgB,CAAC+M,QAAQ,CAAC;YAC/CC,MAAM,cAAAvN,MAAA,CAAcmN,KAAK,CAACpN,IAAI,CAAE;YAChCyN,IAAI,EAAE3Q,OAAO,CAAC4Q;UAChB,CAAC,CAAC;UAEF,IAAI,CAACtD,WAAW,GAAAuD,aAAA,CAAAA,aAAA,KACX,IAAI,CAACvD,WAAW;YACnBwD,GAAG,EAAEN;UAAS,EACf;QACH;QACA,IAAI,CAACtH,MAAM,CAAC2F,KAAK,CAAClN,KAAK,CAACe,OAAO,CAACyM,KAAK,CAAC;UAAC2B,GAAG,EAAE,IAAI,CAACxD,WAAW,CAACwD;QAAG,CAAC,CAAC,CAAC;MACrE;IACF;EAAC;IAAAxJ,GAAA;IAAAK,KAAA,EAED,SAAAqB,iBAAA,EAAmB;MACjB,IAAI,IAAI,CAACjC,WAAW,EAAE;QACpBrG,SAAS,CAACiO,KAAK,CAAC,CAAC;QACjBjO,SAAS,CAACkO,OAAO,0BAAAzL,MAAA,CAAyB,IAAI,CAACQ,oBAAoB,CAACoN,QAAQ,SAAK,CAAC;QAClF,IAAI,CAAC7H,MAAM,CAAC2F,KAAK,CAACnO,SAAS,CAAC;MAC9B;IACF;EAAC;IAAA4G,GAAA;IAAAK,KAAA,EAED,SAAAqJ,iBAAA,EAAmB;MACjB;MACA;MACA;IAAA;EACD;IAAA1J,GAAA;IAAAK,KAAA,EAED,SAAAsB,qBAAA,EAAuB;MACrB,IAAI,CAACwF,MAAM,CAAC,cAAc,CAAC;IAC7B;EAAC;EAAA,OAAA3L,eAAA;AAAA;AAGHmO,MAAM,CAACC,OAAO,GAAGpO,eAAe"}
{"version":3,"file":"string-buf.js","names":["StringBuf","options","_classCallCheck","_buf","Buffer","alloc","size","_encoding","encoding","_inPos","_buffer","undefined","_createClass","key","get","length","value","toBuffer","copy","reset","position","_grow","min","buf","addText","text","inPos","write","addStringBuf","inBuf","capacity","module","exports"],"sources":["../../../lib/utils/string-buf.js"],"sourcesContent":["// StringBuf - a way to keep string memory operations to a minimum\n// while building the strings for the xml files\nclass StringBuf {\n  constructor(options) {\n    this._buf = Buffer.alloc((options && options.size) || 16384);\n    this._encoding = (options && options.encoding) || 'utf8';\n\n    // where in the buffer we are at\n    this._inPos = 0;\n\n    // for use by toBuffer()\n    this._buffer = undefined;\n  }\n\n  get length() {\n    return this._inPos;\n  }\n\n  get capacity() {\n    return this._buf.length;\n  }\n\n  get buffer() {\n    return this._buf;\n  }\n\n  toBuffer() {\n    // return the current data as a single enclosing buffer\n    if (!this._buffer) {\n      this._buffer = Buffer.alloc(this.length);\n      this._buf.copy(this._buffer, 0, 0, this.length);\n    }\n    return this._buffer;\n  }\n\n  reset(position) {\n    position = position || 0;\n    this._buffer = undefined;\n    this._inPos = position;\n  }\n\n  _grow(min) {\n    let size = this._buf.length * 2;\n    while (size < min) {\n      size *= 2;\n    }\n    const buf = Buffer.alloc(size);\n    this._buf.copy(buf, 0);\n    this._buf = buf;\n  }\n\n  addText(text) {\n    this._buffer = undefined;\n\n    let inPos = this._inPos + this._buf.write(text, this._inPos, this._encoding);\n\n    // if we've hit (or nearing capacity), grow the buf\n    while (inPos >= this._buf.length - 4) {\n      this._grow(this._inPos + text.length);\n\n      // keep trying to write until we've completely written the text\n      inPos = this._inPos + this._buf.write(text, this._inPos, this._encoding);\n    }\n\n    this._inPos = inPos;\n  }\n\n  addStringBuf(inBuf) {\n    if (inBuf.length) {\n      this._buffer = undefined;\n\n      if (this.length + inBuf.length > this.capacity) {\n        this._grow(this.length + inBuf.length);\n      }\n      // eslint-disable-next-line no-underscore-dangle\n      inBuf._buf.copy(this._buf, this._inPos, 0, inBuf.length);\n      this._inPos += inBuf.length;\n    }\n  }\n}\n\nmodule.exports = StringBuf;\n"],"mappings":";;;;;;;;AAAA;AACA;AAAA,IACMA,SAAS;EACb,SAAAA,UAAYC,OAAO,EAAE;IAAAC,eAAA,OAAAF,SAAA;IACnB,IAAI,CAACG,IAAI,GAAGC,MAAM,CAACC,KAAK,CAAEJ,OAAO,IAAIA,OAAO,CAACK,IAAI,IAAK,KAAK,CAAC;IAC5D,IAAI,CAACC,SAAS,GAAIN,OAAO,IAAIA,OAAO,CAACO,QAAQ,IAAK,MAAM;;IAExD;IACA,IAAI,CAACC,MAAM,GAAG,CAAC;;IAEf;IACA,IAAI,CAACC,OAAO,GAAGC,SAAS;EAC1B;EAACC,YAAA,CAAAZ,SAAA;IAAAa,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAa;MACX,OAAO,IAAI,CAACL,MAAM;IACpB;EAAC;IAAAI,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAe;MACb,OAAO,IAAI,CAACX,IAAI,CAACY,MAAM;IACzB;EAAC;IAAAF,GAAA;IAAAC,GAAA,EAED,SAAAA,IAAA,EAAa;MACX,OAAO,IAAI,CAACX,IAAI;IAClB;EAAC;IAAAU,GAAA;IAAAG,KAAA,EAED,SAAAC,SAAA,EAAW;MACT;MACA,IAAI,CAAC,IAAI,CAACP,OAAO,EAAE;QACjB,IAAI,CAACA,OAAO,GAAGN,MAAM,CAACC,KAAK,CAAC,IAAI,CAACU,MAAM,CAAC;QACxC,IAAI,CAACZ,IAAI,CAACe,IAAI,CAAC,IAAI,CAACR,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,IAAI,CAACK,MAAM,CAAC;MACjD;MACA,OAAO,IAAI,CAACL,OAAO;IACrB;EAAC;IAAAG,GAAA;IAAAG,KAAA,EAED,SAAAG,MAAMC,QAAQ,EAAE;MACdA,QAAQ,GAAGA,QAAQ,IAAI,CAAC;MACxB,IAAI,CAACV,OAAO,GAAGC,SAAS;MACxB,IAAI,CAACF,MAAM,GAAGW,QAAQ;IACxB;EAAC;IAAAP,GAAA;IAAAG,KAAA,EAED,SAAAK,MAAMC,GAAG,EAAE;MACT,IAAIhB,IAAI,GAAG,IAAI,CAACH,IAAI,CAACY,MAAM,GAAG,CAAC;MAC/B,OAAOT,IAAI,GAAGgB,GAAG,EAAE;QACjBhB,IAAI,IAAI,CAAC;MACX;MACA,IAAMiB,GAAG,GAAGnB,MAAM,CAACC,KAAK,CAACC,IAAI,CAAC;MAC9B,IAAI,CAACH,IAAI,CAACe,IAAI,CAACK,GAAG,EAAE,CAAC,CAAC;MACtB,IAAI,CAACpB,IAAI,GAAGoB,GAAG;IACjB;EAAC;IAAAV,GAAA;IAAAG,KAAA,EAED,SAAAQ,QAAQC,IAAI,EAAE;MACZ,IAAI,CAACf,OAAO,GAAGC,SAAS;MAExB,IAAIe,KAAK,GAAG,IAAI,CAACjB,MAAM,GAAG,IAAI,CAACN,IAAI,CAACwB,KAAK,CAACF,IAAI,EAAE,IAAI,CAAChB,MAAM,EAAE,IAAI,CAACF,SAAS,CAAC;;MAE5E;MACA,OAAOmB,KAAK,IAAI,IAAI,CAACvB,IAAI,CAACY,MAAM,GAAG,CAAC,EAAE;QACpC,IAAI,CAACM,KAAK,CAAC,IAAI,CAACZ,MAAM,GAAGgB,IAAI,CAACV,MAAM,CAAC;;QAErC;QACAW,KAAK,GAAG,IAAI,CAACjB,MAAM,GAAG,IAAI,CAACN,IAAI,CAACwB,KAAK,CAACF,IAAI,EAAE,IAAI,CAAChB,MAAM,EAAE,IAAI,CAACF,SAAS,CAAC;MAC1E;MAEA,IAAI,CAACE,MAAM,GAAGiB,KAAK;IACrB;EAAC;IAAAb,GAAA;IAAAG,KAAA,EAED,SAAAY,aAAaC,KAAK,EAAE;MAClB,IAAIA,KAAK,CAACd,MAAM,EAAE;QAChB,IAAI,CAACL,OAAO,GAAGC,SAAS;QAExB,IAAI,IAAI,CAACI,MAAM,GAAGc,KAAK,CAACd,MAAM,GAAG,IAAI,CAACe,QAAQ,EAAE;UAC9C,IAAI,CAACT,KAAK,CAAC,IAAI,CAACN,MAAM,GAAGc,KAAK,CAACd,MAAM,CAAC;QACxC;QACA;QACAc,KAAK,CAAC1B,IAAI,CAACe,IAAI,CAAC,IAAI,CAACf,IAAI,EAAE,IAAI,CAACM,MAAM,EAAE,CAAC,EAAEoB,KAAK,CAACd,MAAM,CAAC;QACxD,IAAI,CAACN,MAAM,IAAIoB,KAAK,CAACd,MAAM;MAC7B;IACF;EAAC;EAAA,OAAAf,SAAA;AAAA;AAGH+B,MAAM,CAACC,OAAO,GAAGhC,SAAS"}
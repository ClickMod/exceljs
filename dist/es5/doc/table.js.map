{"version":3,"file":"table.js","names":["colCache","require","Column","table","column","index","_classCallCheck","_createClass","key","value","_set","name","cacheState","get","set","filterButton","style","totalsRowLabel","totalsRowFunction","totalsRowResult","totalsRowFormula","Table","worksheet","validate","store","getFormula","concat","Error","columns","length","rows","height","headerRow","filterHeight","totalsRow","_this","assign","o","dflt","undefined","assert","test","message","ref","tl","decodeAddress","_table$tl","row","col","width","tableHeight","autoFilterRef","encode","tableRef","forEach","i","_this2","assignStyle","cell","Object","keys","_table$tl2","count","r","getRow","j","getCell","data","formula","result","load","_this3","_table$tl3","_cache","commit","addRow","values","rowNumber","push","splice","removeRows","rowIndex","arguments","getColumn","colIndex","addColumn","removeColumns","_assign","target","prop","displyName","displayName","showFirstColumn","showLastColumn","showRowStripes","showColumnStripes","module","exports"],"sources":["../../../lib/doc/table.js"],"sourcesContent":["/* eslint-disable max-classes-per-file */\nconst colCache = require('../utils/col-cache');\n\nclass Column {\n  // wrapper around column model, allowing access and manipulation\n  constructor(table, column, index) {\n    this.table = table;\n    this.column = column;\n    this.index = index;\n  }\n\n  _set(name, value) {\n    this.table.cacheState();\n    this.column[name] = value;\n  }\n\n  /* eslint-disable lines-between-class-members */\n  get name() {\n    return this.column.name;\n  }\n  set name(value) {\n    this._set('name', value);\n  }\n\n  get filterButton() {\n    return this.column.filterButton;\n  }\n  set filterButton(value) {\n    this.column.filterButton = value;\n  }\n\n  get style() {\n    return this.column.style;\n  }\n  set style(value) {\n    this.column.style = value;\n  }\n\n  get totalsRowLabel() {\n    return this.column.totalsRowLabel;\n  }\n  set totalsRowLabel(value) {\n    this._set('totalsRowLabel', value);\n  }\n\n  get totalsRowFunction() {\n    return this.column.totalsRowFunction;\n  }\n  set totalsRowFunction(value) {\n    this._set('totalsRowFunction', value);\n  }\n\n  get totalsRowResult() {\n    return this.column.totalsRowResult;\n  }\n  set totalsRowResult(value) {\n    this._set('totalsRowResult', value);\n  }\n\n  get totalsRowFormula() {\n    return this.column.totalsRowFormula;\n  }\n  set totalsRowFormula(value) {\n    this._set('totalsRowFormula', value);\n  }\n  /* eslint-enable lines-between-class-members */\n}\n\nclass Table {\n  constructor(worksheet, table) {\n    this.worksheet = worksheet;\n    if (table) {\n      this.table = table;\n      // check things are ok first\n      this.validate();\n\n      this.store();\n    }\n  }\n\n  getFormula(column) {\n    // get the correct formula to apply to the totals row\n    switch (column.totalsRowFunction) {\n      case 'none':\n        return null;\n      case 'average':\n        return `SUBTOTAL(101,${this.table.name}[${column.name}])`;\n      case 'countNums':\n        return `SUBTOTAL(102,${this.table.name}[${column.name}])`;\n      case 'count':\n        return `SUBTOTAL(103,${this.table.name}[${column.name}])`;\n      case 'max':\n        return `SUBTOTAL(104,${this.table.name}[${column.name}])`;\n      case 'min':\n        return `SUBTOTAL(105,${this.table.name}[${column.name}])`;\n      case 'stdDev':\n        return `SUBTOTAL(106,${this.table.name}[${column.name}])`;\n      case 'var':\n        return `SUBTOTAL(107,${this.table.name}[${column.name}])`;\n      case 'sum':\n        return `SUBTOTAL(109,${this.table.name}[${column.name}])`;\n      case 'custom':\n        return column.totalsRowFormula;\n      default:\n        throw new Error(`Invalid Totals Row Function: ${column.totalsRowFunction}`);\n    }\n  }\n\n  get width() {\n    // width of the table\n    return this.table.columns.length;\n  }\n\n  get height() {\n    // height of the table data\n    return this.table.rows.length;\n  }\n\n  get filterHeight() {\n    // height of the table data plus optional header row\n    return this.height + (this.table.headerRow ? 1 : 0);\n  }\n\n  get tableHeight() {\n    // full height of the table on the sheet\n    return this.filterHeight + (this.table.totalsRow ? 1 : 0);\n  }\n\n  validate() {\n    const {table} = this;\n    // set defaults and check is valid\n    const assign = (o, name, dflt) => {\n      if (o[name] === undefined) {\n        o[name] = dflt;\n      }\n    };\n    assign(table, 'headerRow', true);\n    assign(table, 'totalsRow', false);\n\n    assign(table, 'style', {});\n    assign(table.style, 'theme', 'TableStyleMedium2');\n    assign(table.style, 'showFirstColumn', false);\n    assign(table.style, 'showLastColumn', false);\n    assign(table.style, 'showRowStripes', false);\n    assign(table.style, 'showColumnStripes', false);\n\n    const assert = (test, message) => {\n      if (!test) {\n        throw new Error(message);\n      }\n    };\n    assert(table.ref, 'Table must have ref');\n    assert(table.columns, 'Table must have column definitions');\n    assert(table.rows, 'Table must have row definitions');\n\n    table.tl = colCache.decodeAddress(table.ref);\n    const {row, col} = table.tl;\n    assert(row > 0, 'Table must be on valid row');\n    assert(col > 0, 'Table must be on valid col');\n\n    const {width, filterHeight, tableHeight} = this;\n\n    // autoFilterRef is a range that includes optional headers only\n    table.autoFilterRef = colCache.encode(row, col, row + filterHeight - 1, col + width - 1);\n\n    // tableRef is a range that includes optional headers and totals\n    table.tableRef = colCache.encode(row, col, row + tableHeight - 1, col + width - 1);\n\n    table.columns.forEach((column, i) => {\n      assert(column.name, `Column ${i} must have a name`);\n      if (i === 0) {\n        assign(column, 'totalsRowLabel', 'Total');\n      } else {\n        assign(column, 'totalsRowFunction', 'none');\n        column.totalsRowFormula = this.getFormula(column);\n      }\n    });\n  }\n\n  store() {\n    // where the table needs to store table data, headers, footers in\n    // the sheet...\n    const assignStyle = (cell, style) => {\n      if (style) {\n        Object.keys(style).forEach(key => {\n          cell[key] = style[key];\n        });\n      }\n    };\n\n    const {worksheet, table} = this;\n    const {row, col} = table.tl;\n    let count = 0;\n    if (table.headerRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const {style, name} = column;\n        const cell = r.getCell(col + j);\n        cell.value = name;\n        assignStyle(cell, style);\n      });\n    }\n    table.rows.forEach(data => {\n      const r = worksheet.getRow(row + count++);\n      data.forEach((value, j) => {\n        const cell = r.getCell(col + j);\n        cell.value = value;\n\n        assignStyle(cell, table.columns[j].style);\n      });\n    });\n\n    if (table.totalsRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const cell = r.getCell(col + j);\n        if (j === 0) {\n          cell.value = column.totalsRowLabel;\n        } else {\n          const formula = this.getFormula(column);\n          if (formula) {\n            cell.value = {\n              formula: column.totalsRowFormula,\n              result: column.totalsRowResult,\n            };\n          } else {\n            cell.value = null;\n          }\n        }\n\n        assignStyle(cell, column.style);\n      });\n    }\n  }\n\n  load(worksheet) {\n    // where the table will read necessary features from a loaded sheet\n    const {table} = this;\n    const {row, col} = table.tl;\n    let count = 0;\n    if (table.headerRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const cell = r.getCell(col + j);\n        cell.value = column.name;\n      });\n    }\n    table.rows.forEach(data => {\n      const r = worksheet.getRow(row + count++);\n      data.forEach((value, j) => {\n        const cell = r.getCell(col + j);\n        cell.value = value;\n      });\n    });\n\n    if (table.totalsRow) {\n      const r = worksheet.getRow(row + count++);\n      table.columns.forEach((column, j) => {\n        const cell = r.getCell(col + j);\n        if (j === 0) {\n          cell.value = column.totalsRowLabel;\n        } else {\n          const formula = this.getFormula(column);\n          if (formula) {\n            cell.value = {\n              formula: column.totalsRowFormula,\n              result: column.totalsRowResult,\n            };\n          }\n        }\n      });\n    }\n  }\n\n  get model() {\n    return this.table;\n  }\n\n  set model(value) {\n    this.table = value;\n  }\n\n  // ================================================================\n  // TODO: Mutating methods\n  cacheState() {\n    if (!this._cache) {\n      this._cache = {\n        ref: this.ref,\n        width: this.width,\n        tableHeight: this.tableHeight,\n      };\n    }\n  }\n\n  commit() {\n    // changes may have been made that might have on-sheet effects\n    if (!this._cache) {\n      return;\n    }\n\n    // check things are ok first\n    this.validate();\n\n    const ref = colCache.decodeAddress(this._cache.ref);\n    if (this.ref !== this._cache.ref) {\n      // wipe out whole table footprint at previous location\n      for (let i = 0; i < this._cache.tableHeight; i++) {\n        const row = this.worksheet.getRow(ref.row + i);\n        for (let j = 0; j < this._cache.width; j++) {\n          const cell = row.getCell(ref.col + j);\n          cell.value = null;\n        }\n      }\n    } else {\n      // clear out below table if it has shrunk\n      for (let i = this.tableHeight; i < this._cache.tableHeight; i++) {\n        const row = this.worksheet.getRow(ref.row + i);\n        for (let j = 0; j < this._cache.width; j++) {\n          const cell = row.getCell(ref.col + j);\n          cell.value = null;\n        }\n      }\n\n      // clear out to right of table if it has lost columns\n      for (let i = 0; i < this.tableHeight; i++) {\n        const row = this.worksheet.getRow(ref.row + i);\n        for (let j = this.width; j < this._cache.width; j++) {\n          const cell = row.getCell(ref.col + j);\n          cell.value = null;\n        }\n      }\n    }\n\n    this.store();\n  }\n\n  addRow(values, rowNumber) {\n    // Add a row of data, either insert at rowNumber or append\n    this.cacheState();\n\n    if (rowNumber === undefined) {\n      this.table.rows.push(values);\n    } else {\n      this.table.rows.splice(rowNumber, 0, values);\n    }\n  }\n\n  removeRows(rowIndex, count = 1) {\n    // Remove a rows of data\n    this.cacheState();\n    this.table.rows.splice(rowIndex, count);\n  }\n\n  getColumn(colIndex) {\n    const column = this.table.columns[colIndex];\n    return new Column(this, column, colIndex);\n  }\n\n  addColumn(column, values, colIndex) {\n    // Add a new column, including column defn and values\n    // Inserts at colNumber or adds to the right\n    this.cacheState();\n\n    if (colIndex === undefined) {\n      this.table.columns.push(column);\n      this.table.rows.forEach((row, i) => {\n        row.push(values[i]);\n      });\n    } else {\n      this.table.columns.splice(colIndex, 0, column);\n      this.table.rows.forEach((row, i) => {\n        row.splice(colIndex, 0, values[i]);\n      });\n    }\n  }\n\n  removeColumns(colIndex, count = 1) {\n    // Remove a column with data\n    this.cacheState();\n\n    this.table.columns.splice(colIndex, count);\n    this.table.rows.forEach(row => {\n      row.splice(colIndex, count);\n    });\n  }\n\n  _assign(target, prop, value) {\n    this.cacheState();\n    target[prop] = value;\n  }\n\n  /* eslint-disable lines-between-class-members */\n  get ref() {\n    return this.table.ref;\n  }\n  set ref(value) {\n    this._assign(this.table, 'ref', value);\n  }\n\n  get name() {\n    return this.table.name;\n  }\n  set name(value) {\n    this.table.name = value;\n  }\n\n  get displayName() {\n    return this.table.displyName || this.table.name;\n  }\n  set displayNamename(value) {\n    this.table.displayName = value;\n  }\n\n  get headerRow() {\n    return this.table.headerRow;\n  }\n  set headerRow(value) {\n    this._assign(this.table, 'headerRow', value);\n  }\n\n  get totalsRow() {\n    return this.table.totalsRow;\n  }\n  set totalsRow(value) {\n    this._assign(this.table, 'totalsRow', value);\n  }\n\n  get theme() {\n    return this.table.style.name;\n  }\n  set theme(value) {\n    this.table.style.name = value;\n  }\n\n  get showFirstColumn() {\n    return this.table.style.showFirstColumn;\n  }\n  set showFirstColumn(value) {\n    this.table.style.showFirstColumn = value;\n  }\n\n  get showLastColumn() {\n    return this.table.style.showLastColumn;\n  }\n  set showLastColumn(value) {\n    this.table.style.showLastColumn = value;\n  }\n\n  get showRowStripes() {\n    return this.table.style.showRowStripes;\n  }\n  set showRowStripes(value) {\n    this.table.style.showRowStripes = value;\n  }\n\n  get showColumnStripes() {\n    return this.table.style.showColumnStripes;\n  }\n  set showColumnStripes(value) {\n    this.table.style.showColumnStripes = value;\n  }\n  /* eslint-enable lines-between-class-members */\n}\n\nmodule.exports = Table;\n"],"mappings":"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"}
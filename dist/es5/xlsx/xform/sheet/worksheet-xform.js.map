{"version":3,"file":"worksheet-xform.js","names":["_","require","colCache","XmlStream","RelType","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","SheetProtectionXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","TablePartXform","RowBreaksXform","HeaderFooterXform","ConditionalFormattingsXform","ExtListXform","mergeRule","rule","extRule","Object","keys","forEach","key","value","extValue","undefined","mergeConditionalFormattings","model","extModel","length","cfMap","ruleMap","cf","ref","rules","x14Id","extCf","push","WorkSheetXform","_BaseXform","_inherits","_super","_createSuper","options","_this","_classCallCheck","call","_ref","maxRows","maxCols","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","maxItems","autoFilter","mergeCells","rowBreaks","hyperlinks","pageMargins","dataValidations","pageSetup","headerFooter","printOptions","picture","drawing","sheetProtection","tableParts","conditionalFormatting","extLst","_createClass","prepare","_this2","merges","comments","formulae","siFormulae","rows","conditionalFormattings","rels","nextRid","r","concat","hyperlink","rId","Id","Type","Hyperlink","Target","target","TargetMode","comment","Comments","id","vmlDrawing","VmlDrawing","item","refAddress","decodeAddress","commentRefs","commentName","drawingRelsHash","bookImage","media","medium","type","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","preImageId","anchor","range","rIdHyperLink","tooltip","tables","table","Table","columns","column","style","dxfId","styles","addDxfStyle","render","xmlStream","openXml","StdDocAttributes","openNode","WORKSHEET_ATTRIBUTES","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","defaultColWidth","sheetPropertiesModel","outlineProperties","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","sheetProtectionModel","dimensions","views","rel","leafNode","closeNode","parseOpen","node","parser","each","xform","reset","parseText","text","parseClose","sheetProperties","assign","reconcile","relationships","reduce","h","vmlComment","vmlDrawings","index","note","commentsMap","hyperlinkMap","address","filter","Boolean","row","cells","drawingRel","match","drawingName","backgroundRel","split","mediaIndex","tablePart","xmlns","module","exports"],"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"sourcesContent":["const _ = require('../../../utils/under-dash');\n\nconst colCache = require('../../../utils/col-cache');\nconst XmlStream = require('../../../utils/xml-stream');\n\nconst RelType = require('../../rel-type');\n\nconst Merges = require('./merges');\n\nconst BaseXform = require('../base-xform');\nconst ListXform = require('../list-xform');\nconst RowXform = require('./row-xform');\nconst ColXform = require('./col-xform');\nconst DimensionXform = require('./dimension-xform');\nconst HyperlinkXform = require('./hyperlink-xform');\nconst MergeCellXform = require('./merge-cell-xform');\nconst DataValidationsXform = require('./data-validations-xform');\nconst SheetPropertiesXform = require('./sheet-properties-xform');\nconst SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\nconst SheetViewXform = require('./sheet-view-xform');\nconst SheetProtectionXform = require('./sheet-protection-xform');\nconst PageMarginsXform = require('./page-margins-xform');\nconst PageSetupXform = require('./page-setup-xform');\nconst PrintOptionsXform = require('./print-options-xform');\nconst AutoFilterXform = require('./auto-filter-xform');\nconst PictureXform = require('./picture-xform');\nconst DrawingXform = require('./drawing-xform');\nconst TablePartXform = require('./table-part-xform');\nconst RowBreaksXform = require('./row-breaks-xform');\nconst HeaderFooterXform = require('./header-footer-xform');\nconst ConditionalFormattingsXform = require('./cf/conditional-formattings-xform');\nconst ExtListXform = require('./ext-lst-xform');\n\nconst mergeRule = (rule, extRule) => {\n  Object.keys(extRule).forEach(key => {\n    const value = rule[key];\n    const extValue = extRule[key];\n    if (value === undefined && extValue !== undefined) {\n      rule[key] = extValue;\n    }\n  });\n};\n\nconst mergeConditionalFormattings = (model, extModel) => {\n  // conditional formattings are rendered in worksheet.conditionalFormatting and also in\n  // worksheet.extLst.ext.x14:conditionalFormattings\n  // some (e.g. dataBar) are even spread across both!\n  if (!extModel || !extModel.length) {\n    return model;\n  }\n  if (!model || !model.length) {\n    return extModel;\n  }\n\n  // index model rules by x14Id\n  const cfMap = {};\n  const ruleMap = {};\n  model.forEach(cf => {\n    cfMap[cf.ref] = cf;\n    cf.rules.forEach(rule => {\n      const {x14Id} = rule;\n      if (x14Id) {\n        ruleMap[x14Id] = rule;\n      }\n    });\n  });\n\n  extModel.forEach(extCf => {\n    extCf.rules.forEach(extRule => {\n      const rule = ruleMap[extRule.x14Id];\n      if (rule) {\n        // merge with matching rule\n        mergeRule(rule, extRule);\n      } else if (cfMap[extCf.ref]) {\n        // reuse existing cf ref\n        cfMap[extCf.ref].rules.push(extRule);\n      } else {\n        // create new cf\n        model.push({\n          ref: extCf.ref,\n          rules: [extRule],\n        });\n      }\n    });\n  });\n\n  // need to cope with rules in extModel that don't exist in model\n  return model;\n};\n\nclass WorkSheetXform extends BaseXform {\n  constructor(options) {\n    super();\n\n    const {maxRows, maxCols} = options || {};\n    this.map = {\n      sheetPr: new SheetPropertiesXform(),\n      dimension: new DimensionXform(),\n      sheetViews: new ListXform({\n        tag: 'sheetViews',\n        count: false,\n        childXform: new SheetViewXform(),\n      }),\n      sheetFormatPr: new SheetFormatPropertiesXform(),\n      cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\n      sheetData: new ListXform({\n        tag: 'sheetData',\n        count: false,\n        empty: true,\n        childXform: new RowXform({maxItems: maxCols}),\n        maxItems: maxRows,\n      }),\n      autoFilter: new AutoFilterXform(),\n      mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\n      rowBreaks: new RowBreaksXform(),\n      hyperlinks: new ListXform({\n        tag: 'hyperlinks',\n        count: false,\n        childXform: new HyperlinkXform(),\n      }),\n      pageMargins: new PageMarginsXform(),\n      dataValidations: new DataValidationsXform(),\n      pageSetup: new PageSetupXform(),\n      headerFooter: new HeaderFooterXform(),\n      printOptions: new PrintOptionsXform(),\n      picture: new PictureXform(),\n      drawing: new DrawingXform(),\n      sheetProtection: new SheetProtectionXform(),\n      tableParts: new ListXform({tag: 'tableParts', count: true, childXform: new TablePartXform()}),\n      conditionalFormatting: new ConditionalFormattingsXform(),\n      extLst: new ExtListXform(),\n    };\n  }\n\n  prepare(model, options) {\n    options.merges = new Merges();\n    model.hyperlinks = options.hyperlinks = [];\n    model.comments = options.comments = [];\n\n    options.formulae = {};\n    options.siFormulae = 0;\n    this.map.cols.prepare(model.cols, options);\n    this.map.sheetData.prepare(model.rows, options);\n    this.map.conditionalFormatting.prepare(model.conditionalFormattings, options);\n\n    model.mergeCells = options.merges.mergeCells;\n\n    // prepare relationships\n    const rels = (model.rels = []);\n\n    function nextRid(r) {\n      return `rId${r.length + 1}`;\n    }\n\n    model.hyperlinks.forEach(hyperlink => {\n      const rId = nextRid(rels);\n      hyperlink.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Hyperlink,\n        Target: hyperlink.target,\n        TargetMode: 'External',\n      });\n    });\n\n    // prepare comment relationships\n    if (model.comments.length > 0) {\n      const comment = {\n        Id: nextRid(rels),\n        Type: RelType.Comments,\n        Target: `../comments${model.id}.xml`,\n      };\n      rels.push(comment);\n      const vmlDrawing = {\n        Id: nextRid(rels),\n        Type: RelType.VmlDrawing,\n        Target: `../drawings/vmlDrawing${model.id}.vml`,\n      };\n      rels.push(vmlDrawing);\n\n      model.comments.forEach(item => {\n        item.refAddress = colCache.decodeAddress(item.ref);\n      });\n\n      options.commentRefs.push({\n        commentName: `comments${model.id}`,\n        vmlDrawing: `vmlDrawing${model.id}`,\n      });\n    }\n\n    const drawingRelsHash = [];\n    let bookImage;\n    model.media.forEach(medium => {\n      if (medium.type === 'background') {\n        const rId = nextRid(rels);\n        bookImage = options.media[medium.imageId];\n        rels.push({\n          Id: rId,\n          Type: RelType.Image,\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\n        });\n        model.background = {\n          rId,\n        };\n        model.image = options.media[medium.imageId];\n      } else if (medium.type === 'image') {\n        let {drawing} = model;\n        bookImage = options.media[medium.imageId];\n        if (!drawing) {\n          drawing = model.drawing = {\n            rId: nextRid(rels),\n            name: `drawing${++options.drawingsCount}`,\n            anchors: [],\n            rels: [],\n          };\n          options.drawings.push(drawing);\n          rels.push({\n            Id: drawing.rId,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\n            Target: `../drawings/${drawing.name}.xml`,\n          });\n        }\n        let rIdImage =\n          this.preImageId === medium.imageId\n            ? drawingRelsHash[medium.imageId]\n            : drawingRelsHash[drawing.rels.length];\n        if (!rIdImage) {\n          rIdImage = nextRid(drawing.rels);\n          drawingRelsHash[drawing.rels.length] = rIdImage;\n          drawing.rels.push({\n            Id: rIdImage,\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\n          });\n        }\n\n        const anchor = {\n          picture: {\n            rId: rIdImage,\n          },\n          range: medium.range,\n        };\n        if (medium.hyperlinks && medium.hyperlinks.hyperlink) {\n          const rIdHyperLink = nextRid(drawing.rels);\n          drawingRelsHash[drawing.rels.length] = rIdHyperLink;\n          anchor.picture.hyperlinks = {\n            tooltip: medium.hyperlinks.tooltip,\n            rId: rIdHyperLink,\n          };\n          drawing.rels.push({\n            Id: rIdHyperLink,\n            Type: RelType.Hyperlink,\n            Target: medium.hyperlinks.hyperlink,\n            TargetMode: 'External',\n          });\n        }\n        this.preImageId = medium.imageId;\n        drawing.anchors.push(anchor);\n      }\n    });\n\n    // prepare tables\n    model.tables.forEach(table => {\n      // relationships\n      const rId = nextRid(rels);\n      table.rId = rId;\n      rels.push({\n        Id: rId,\n        Type: RelType.Table,\n        Target: `../tables/${table.target}`,\n      });\n\n      // dynamic styles\n      table.columns.forEach(column => {\n        const {style} = column;\n        if (style) {\n          column.dxfId = options.styles.addDxfStyle(style);\n        }\n      });\n    });\n\n    // prepare ext items\n    this.map.extLst.prepare(model, options);\n  }\n\n  render(xmlStream, model) {\n    xmlStream.openXml(XmlStream.StdDocAttributes);\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\n\n    const sheetFormatPropertiesModel = model.properties\n      ? {\n          defaultRowHeight: model.properties.defaultRowHeight,\n          dyDescent: model.properties.dyDescent,\n          outlineLevelCol: model.properties.outlineLevelCol,\n          outlineLevelRow: model.properties.outlineLevelRow,\n        }\n      : undefined;\n    if (model.properties && model.properties.defaultColWidth) {\n      sheetFormatPropertiesModel.defaultColWidth = model.properties.defaultColWidth;\n    }\n    const sheetPropertiesModel = {\n      outlineProperties: model.properties && model.properties.outlineProperties,\n      tabColor: model.properties && model.properties.tabColor,\n      pageSetup:\n        model.pageSetup && model.pageSetup.fitToPage\n          ? {\n              fitToPage: model.pageSetup.fitToPage,\n            }\n          : undefined,\n    };\n    const pageMarginsModel = model.pageSetup && model.pageSetup.margins;\n    const printOptionsModel = {\n      showRowColHeaders: model.pageSetup && model.pageSetup.showRowColHeaders,\n      showGridLines: model.pageSetup && model.pageSetup.showGridLines,\n      horizontalCentered: model.pageSetup && model.pageSetup.horizontalCentered,\n      verticalCentered: model.pageSetup && model.pageSetup.verticalCentered,\n    };\n    const sheetProtectionModel = model.sheetProtection;\n\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\n    this.map.dimension.render(xmlStream, model.dimensions);\n    this.map.sheetViews.render(xmlStream, model.views);\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\n    this.map.cols.render(xmlStream, model.cols);\n    this.map.sheetData.render(xmlStream, model.rows);\n    this.map.sheetProtection.render(xmlStream, sheetProtectionModel); // Note: must be after sheetData and before autoFilter\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\n    this.map.conditionalFormatting.render(xmlStream, model.conditionalFormattings); // Note: must be before dataValidations\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\n\n    // For some reason hyperlinks have to be after the data validations\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\n\n    this.map.printOptions.render(xmlStream, printOptionsModel); // Note: must be before pageMargins\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\n    this.map.headerFooter.render(xmlStream, model.headerFooter);\n    this.map.rowBreaks.render(xmlStream, model.rowBreaks);\n    this.map.drawing.render(xmlStream, model.drawing); // Note: must be after rowBreaks\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\n    this.map.tableParts.render(xmlStream, model.tables);\n\n    this.map.extLst.render(xmlStream, model);\n\n    if (model.rels) {\n      // add a <legacyDrawing /> node for each comment\n      model.rels.forEach(rel => {\n        if (rel.Type === RelType.VmlDrawing) {\n          xmlStream.leafNode('legacyDrawing', {'r:id': rel.Id});\n        }\n      });\n    }\n\n    xmlStream.closeNode();\n  }\n\n  parseOpen(node) {\n    if (this.parser) {\n      this.parser.parseOpen(node);\n      return true;\n    }\n\n    if (node.name === 'worksheet') {\n      _.each(this.map, xform => {\n        xform.reset();\n      });\n      return true;\n    }\n\n    this.parser = this.map[node.name];\n    if (this.parser) {\n      this.parser.parseOpen(node);\n    }\n    return true;\n  }\n\n  parseText(text) {\n    if (this.parser) {\n      this.parser.parseText(text);\n    }\n  }\n\n  parseClose(name) {\n    if (this.parser) {\n      if (!this.parser.parseClose(name)) {\n        this.parser = undefined;\n      }\n      return true;\n    }\n    switch (name) {\n      case 'worksheet': {\n        const properties = this.map.sheetFormatPr.model || {};\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\n          properties.tabColor = this.map.sheetPr.model.tabColor;\n        }\n        if (this.map.sheetPr.model && this.map.sheetPr.model.outlineProperties) {\n          properties.outlineProperties = this.map.sheetPr.model.outlineProperties;\n        }\n        const sheetProperties = {\n          fitToPage:\n            (this.map.sheetPr.model &&\n              this.map.sheetPr.model.pageSetup &&\n              this.map.sheetPr.model.pageSetup.fitToPage) ||\n            false,\n          margins: this.map.pageMargins.model,\n        };\n        const pageSetup = Object.assign(\n          sheetProperties,\n          this.map.pageSetup.model,\n          this.map.printOptions.model\n        );\n        const conditionalFormattings = mergeConditionalFormattings(\n          this.map.conditionalFormatting.model,\n          this.map.extLst.model && this.map.extLst.model['x14:conditionalFormattings']\n        );\n        this.model = {\n          dimensions: this.map.dimension.model,\n          cols: this.map.cols.model,\n          rows: this.map.sheetData.model,\n          mergeCells: this.map.mergeCells.model,\n          hyperlinks: this.map.hyperlinks.model,\n          dataValidations: this.map.dataValidations.model,\n          properties,\n          views: this.map.sheetViews.model,\n          pageSetup,\n          headerFooter: this.map.headerFooter.model,\n          background: this.map.picture.model,\n          drawing: this.map.drawing.model,\n          tables: this.map.tableParts.model,\n          conditionalFormattings,\n        };\n\n        if (this.map.autoFilter.model) {\n          this.model.autoFilter = this.map.autoFilter.model;\n        }\n        if (this.map.sheetProtection.model) {\n          this.model.sheetProtection = this.map.sheetProtection.model;\n        }\n\n        return false;\n      }\n\n      default:\n        // not quite sure how we get here!\n        return true;\n    }\n  }\n\n  reconcile(model, options) {\n    // options.merges = new Merges();\n    // options.merges.reconcile(model.mergeCells, model.rows);\n    const rels = (model.relationships || []).reduce((h, rel) => {\n      h[rel.Id] = rel;\n      if (rel.Type === RelType.Comments) {\n        model.comments = options.comments[rel.Target].comments;\n      }\n      if (rel.Type === RelType.VmlDrawing && model.comments && model.comments.length) {\n        const vmlComment = options.vmlDrawings[rel.Target].comments;\n        model.comments.forEach((comment, index) => {\n          comment.note = Object.assign({}, comment.note, vmlComment[index]);\n        });\n      }\n      return h;\n    }, {});\n    options.commentsMap = (model.comments || []).reduce((h, comment) => {\n      if (comment.ref) {\n        h[comment.ref] = comment;\n      }\n      return h;\n    }, {});\n    options.hyperlinkMap = (model.hyperlinks || []).reduce((h, hyperlink) => {\n      if (hyperlink.rId) {\n        h[hyperlink.address] = rels[hyperlink.rId].Target;\n      }\n      return h;\n    }, {});\n    options.formulae = {};\n\n    // compact the rows and cells\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\n    model.rows.forEach(row => {\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\n    });\n\n    this.map.cols.reconcile(model.cols, options);\n    this.map.sheetData.reconcile(model.rows, options);\n    this.map.conditionalFormatting.reconcile(model.conditionalFormattings, options);\n\n    model.media = [];\n    if (model.drawing) {\n      const drawingRel = rels[model.drawing.rId];\n      const match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\n      if (match) {\n        const drawingName = match[1];\n        const drawing = options.drawings[drawingName];\n        drawing.anchors.forEach(anchor => {\n          if (anchor.medium) {\n            const image = {\n              type: 'image',\n              imageId: anchor.medium.index,\n              range: anchor.range,\n              hyperlinks: anchor.picture.hyperlinks,\n            };\n            model.media.push(image);\n          }\n        });\n      }\n    }\n\n    const backgroundRel = model.background && rels[model.background.rId];\n    if (backgroundRel) {\n      const target = backgroundRel.Target.split('/media/')[1];\n      const imageId = options.mediaIndex && options.mediaIndex[target];\n      if (imageId !== undefined) {\n        model.media.push({\n          type: 'background',\n          imageId,\n        });\n      }\n    }\n\n    model.tables = (model.tables || []).map(tablePart => {\n      const rel = rels[tablePart.rId];\n      return options.tables[rel.Target];\n    });\n\n    delete model.relationships;\n    delete model.hyperlinks;\n    delete model.comments;\n  }\n}\n\nWorkSheetXform.WORKSHEET_ATTRIBUTES = {\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\n  'mc:Ignorable': 'x14ac',\n  'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\n};\n\nmodule.exports = WorkSheetXform;\n"],"mappings":"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"}